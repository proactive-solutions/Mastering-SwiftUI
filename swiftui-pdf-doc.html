<!DOCTYPE HTML>
<html lang="zh-tw" >
    
    <head>
        
        <meta charset=utf-8"UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>如何把 SwiftUI 视图转换为 PDF 文件 | 精通 SwiftUI - iOS 16 版</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.1">
        <meta name="author" content="Simon Ng">
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="./swiftui-gauge.html" />
    
    
    <link rel="prev" href="./swiftui-imagerenderer.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-image-captions/image-captions.css">
        
    
    
        <link rel="stylesheet" href="././styles/website.css">
    

        
    <div class="book" data-level="42" data-basepath="." data-revision="Thu Dec 01 2022 17:36:55 GMT+0800 (HKT)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="输入并搜寻" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
            
            <li>
                <a href="https://www.appcoda.com.tw" target="blank" class="custom-link">Made by AppCoda</a>
            </li>
        
            
            <li>
                <a href="https://www.appcoda.com.tw/contact" target="blank" class="custom-link">Contact us / Support</a>
            </li>
        
            
            <li>
                <a href="http://twitter.com/share?text=Mastering%20SwiftUI%20via%20@appcodamobile&amp;url=https://www.appcoda.com.tw/swiftui/&amp;hashtags=swiftlang" target="blank" class="custom-link">Tweet this book</a>
            </li>
        
        

        
        <li class="divider"></li>
        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                        序言
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="swiftui-basics.html">
            
                
                    <a href="./swiftui-basics.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        SwiftUI 介绍
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="swiftui-text.html">
            
                
                    <a href="./swiftui-text.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        SwiftUI 入门 - 文字的处理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="swiftui-images.html">
            
                
                    <a href="./swiftui-images.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        图片的处理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="swiftui-stacks.html">
            
                
                    <a href="./swiftui-stacks.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        以堆叠布局使用者介面
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="swiftui-scrollview.html">
            
                
                    <a href="./swiftui-scrollview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        ScrollView 与 Carousel UI 的建立
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="swiftui-buttons.html">
            
                
                    <a href="./swiftui-buttons.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        SwiftUI 按钮与渐层
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="swiftui-state.html">
            
                
                    <a href="./swiftui-state.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        状态(State)与绑定(Binding)
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="swiftui-path-shape.html">
            
                
                    <a href="./swiftui-path-shape.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        实现路径(Path)与形状(Shape)来画线与圆饼图
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="swiftui-animation.html">
            
                
                    <a href="./swiftui-animation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        基础动画与转场
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="swiftui-list.html">
            
                
                    <a href="./swiftui-list.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        动态列表、 ForEach 与 Identifiable 的使用方法
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="swiftui-navigation.html">
            
                
                    <a href="./swiftui-navigation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        导览UI与导览列客制化运用
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="swiftui-modal.html">
            
                
                    <a href="./swiftui-modal.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        强制回应视图、浮动按钮与提示的实现
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="swiftui-form.html">
            
                
                    <a href="./swiftui-form.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        以选取器(Picker)、开关(Toggle)与步进器(Stepper)来建立一个表单
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="swiftui-form-data.html">
            
                
                    <a href="./swiftui-form-data.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        使用 Combine 与 Environment 物件进行资料分享
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="swiftui-form-registration.html">
            
                
                    <a href="./swiftui-form-registration.html">
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        以 Combine 与 视图模型建立一个注册表单
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="swiftui-actionsheet-context.html">
            
                
                    <a href="./swiftui-actionsheet-context.html">
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        滑动删除、内容选单与动作列表
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="swiftui-gestures.html">
            
                
                    <a href="./swiftui-gestures.html">
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        认识手势（Gestures）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="swiftui-bottom-sheet.html">
            
                
                    <a href="./swiftui-bottom-sheet.html">
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        以SwiftUI 手势与 GeometryReader 建立一个底部展开式页面
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="swiftui-trip-tinder.html">
            
                
                    <a href="./swiftui-trip-tinder.html">
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        使用手势与动画建立 Tinder 风格的 UI
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="swiftui-advanced-animations.html">
            
                
                    <a href="./swiftui-advanced-animations.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        建立像 Apple Wallet App 的动画和转场效果
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="swiftui-json.html">
            
                
                    <a href="./swiftui-json.html">
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        JSON、滑杆的运用与资料过滤
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="swiftui-core-data.html">
            
                
                    <a href="./swiftui-core-data.html">
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        如何使用 Core Data 建立 ToDo App
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="swiftui-uikit.html">
            
                
                    <a href="./swiftui-uikit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        利用 UIViewRepresentable 整合UIKit 组件
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="24" data-path="swiftui-searchbar.html">
            
                
                    <a href="./swiftui-searchbar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        建立搜寻栏视图并使用自订绑定（Custom Binding）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="swiftui-real-world-app.html">
            
                
                    <a href="./swiftui-real-world-app.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        把所学应用出来！构建个人理财App
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="26" data-path="swiftui-appstoreanimation.html">
            
                
                    <a href="./swiftui-appstoreanimation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                        创建类似App Store使用的动画视图转换
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="27" data-path="swiftui-carousel.html">
            
                
                    <a href="./swiftui-carousel.html">
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                        如何建立图像轮播（Image Carousel）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="28" data-path="swiftui-expandable-list.html">
            
                
                    <a href="./swiftui-expandable-list.html">
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                        如何建立展开式列表视图和大纲视图
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="29" data-path="swiftui-gridlayout.html">
            
                
                    <a href="./swiftui-gridlayout.html">
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                        使用 LazyVGrid 和 LazyHGrid 构建集合视图
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="30" data-path="swiftui-progress-ring.html">
            
                
                    <a href="./swiftui-progress-ring.html">
                        <i class="fa fa-check"></i>
                        
                            <b>30.</b>
                        
                        使用 Shape 和 Animatable 开发带动画的环形进度条
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="31" data-path="swiftui-library.html">
            
                
                    <a href="./swiftui-library.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.</b>
                        
                        如何使用 AnimatableModifier 和 LibraryContentProvider
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="32" data-path="swiftui-texteditor.html">
            
                
                    <a href="./swiftui-texteditor.html">
                        <i class="fa fa-check"></i>
                        
                            <b>32.</b>
                        
                        使用 TextEditor 支持多行文字输入
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="33" data-path="swiftui-matchedgeometry.html">
            
                
                    <a href="./swiftui-matchedgeometry.html">
                        <i class="fa fa-check"></i>
                        
                            <b>33.</b>
                        
                        使用 matchedGeometryEffect为 App 建立绚丽的视图动画
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="34" data-path="swiftui-grid-animation.html">
            
                
                    <a href="./swiftui-grid-animation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>34.</b>
                        
                        ScrollViewReader 和网格动画
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="35" data-path="swiftui-tabview.html">
            
                
                    <a href="./swiftui-tabview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>35.</b>
                        
                        标签视图的运用与自订标签列
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="36" data-path="swiftui-asyncimage.html">
            
                
                    <a href="./swiftui-asyncimage.html">
                        <i class="fa fa-check"></i>
                        
                            <b>36.</b>
                        
                        利用 AsyncImage 非同步加载和显示图像
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="37" data-path="swiftui-searchable.html">
            
                
                    <a href="./swiftui-searchable.html">
                        <i class="fa fa-check"></i>
                        
                            <b>37.</b>
                        
                        利用 Searchable 建立搜寻栏
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="38" data-path="swiftui-charts.html">
            
                
                    <a href="./swiftui-charts.html">
                        <i class="fa fa-check"></i>
                        
                            <b>38.</b>
                        
                        利用 Charts 框架建立图表
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="39" data-path="swiftui-live-text.html">
            
                
                    <a href="./swiftui-live-text.html">
                        <i class="fa fa-check"></i>
                        
                            <b>39.</b>
                        
                        利用 Live Text API 从图片中撷取文本
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="40" data-path="swiftui-sharelink.html">
            
                
                    <a href="./swiftui-sharelink.html">
                        <i class="fa fa-check"></i>
                        
                            <b>40.</b>
                        
                        通过 ShareLink 来分享文本和图像等资料
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="41" data-path="swiftui-imagerenderer.html">
            
                
                    <a href="./swiftui-imagerenderer.html">
                        <i class="fa fa-check"></i>
                        
                            <b>41.</b>
                        
                        利用 ImageRenderer API 轻松把 SwiftUI 视图转换为图像
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="42" data-path="swiftui-pdf-doc.html">
            
                
                    <a href="./swiftui-pdf-doc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>42.</b>
                        
                        如何把 SwiftUI 视图转换为 PDF 文件
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="43" data-path="swiftui-gauge.html">
            
                
                    <a href="./swiftui-gauge.html">
                        <i class="fa fa-check"></i>
                        
                            <b>43.</b>
                        
                        使用 Gauge 视图显示进度并创建速度计
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="44" data-path="swiftui-grid.html">
            
                
                    <a href="./swiftui-grid.html">
                        <i class="fa fa-check"></i>
                        
                            <b>44.</b>
                        
                        使用Grid API 创建网格布局
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="45" data-path="swiftui-anylayout.html">
            
                
                    <a href="./swiftui-anylayout.html">
                        <i class="fa fa-check"></i>
                        
                            <b>45.</b>
                        
                        利用 AnyLayout 切换 UI 布局
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="46" data-path="swiftui-navigationstack.html">
            
                
                    <a href="./swiftui-navigationstack.html">
                        <i class="fa fa-check"></i>
                        
                            <b>46.</b>
                        
                        使用新的 NavigationStack 视图构建资料导向的导航
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                本书使用 GitBook 释出
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="目录"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="搜寻"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="字型设定"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">衬线体</button>
        <button type="button" data-font="1" class="button">无衬线体</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">白色</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">棕褐色</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">夜间</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="分享"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    分享到 Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    分享到 Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    分享到 Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    分享到 Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    分享到 Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >精通 SwiftUI - iOS 16 版</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="%E7%AC%AC-42-%E7%AB%A0-br-%E5%A6%82%E4%BD%95%E6%8A%8A-swiftui-%E8%A6%96%E5%9C%96%E8%BD%89%E6%8F%9B%E7%82%BA-pdf-%E6%96%87%E4%BB%B6">第 42 章<br>如何把 SwiftUI 视图转换为 PDF 文件</h1>
<p>在上一章，我们学习了如何使用 <code>ImageRenderer</code> 撷取 SwiftUI 视图，并储存为图像。这个在 iOS 16 推出的新类别还可以把视图转换为 PDF 文件。</p>
<p>在这篇教学中，我们会以上次的示例为基础进行构建，并添加 <em>Save to PDF</em> 功能。</p>
<h2 id="%E9%87%8D%E6%BA%AB%E4%B8%8A%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E7%9A%84%E7%AF%84%E4%BE%8B-app">重温上一篇文章的示例 App</h2>
<p>如果你还没有读过上一章，我建议你先读过再看此章节。在上一篇文章中，我们已经说明过 <code>ImageRenderer</code> 的基本用法，并解释了示例 App 的实现过程。</p>
<figure id="fig42.1"><img src="images/pdfdoc/swiftui-imagerenderer-pdf.png" alt="图 42.1. 示例 App"><figcaption>图 42.1. 示例 App</figcaption></figure>
<p>要跟着实现的话，可以先下载这个 Starter 项目：<a href="https://www.appcoda.com/resources/swiftui4/SwiftUIImageRendererPDFStarter.zip" target="_blank">https://www.appcoda.com/resources/swiftui4/SwiftUIImageRendererPDFStarter.zip</a>.</p>
<p>我对上次的示例 App 做了一些改动，为折线图添加了 heading 和 caption。示例 App 现在还有一个 <em>PDF</em> 按钮，用来把 Chart 视图保存为 PDF 文件。以下是 <code>ChartView</code> 结构的代码：</p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ChartView</span>: <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">let</span> chartData = [ (city: <span class="hljs-string">&quot;Hong Kong&quot;</span>, data: hkWeatherData),
                      (city: <span class="hljs-string">&quot;London&quot;</span>, data: londonWeatherData),
                      (city: <span class="hljs-string">&quot;Taipei&quot;</span>, data: taipeiWeatherData)
    ]

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Building Line Charts in SwiftUI&quot;</span>)
                .font(.system(size: <span class="hljs-number">40</span>, weight: .heavy, design: .rounded))
                .multilineTextAlignment(.center)
                .padding()

            <span class="hljs-type">Chart</span> {
                <span class="hljs-type">ForEach</span>(chartData, id: \.city) { series <span class="hljs-keyword">in</span>
                    <span class="hljs-type">ForEach</span>(series.data) { item <span class="hljs-keyword">in</span>
                        <span class="hljs-type">LineMark</span>(
                            x: .value(<span class="hljs-string">&quot;Month&quot;</span>, item.date),
                            y: .value(<span class="hljs-string">&quot;Temp&quot;</span>, item.temperature)
                        )
                    }
                    .foregroundStyle(by: .value(<span class="hljs-string">&quot;City&quot;</span>, series.city))
                    .symbol(by: .value(<span class="hljs-string">&quot;City&quot;</span>, series.city))
                }
            }
            .chartXAxis {
                <span class="hljs-type">AxisMarks</span>(values: .stride(by: .month)) { value <span class="hljs-keyword">in</span>
                    <span class="hljs-type">AxisGridLine</span>()
                    <span class="hljs-type">AxisValueLabel</span>(format: .dateTime.month(.defaultDigits))

                }

            }
            .chartPlotStyle { plotArea <span class="hljs-keyword">in</span>
                plotArea
                    .background(.blue.opacity(<span class="hljs-number">0.1</span>))
            }
            .chartYAxis {
                <span class="hljs-type">AxisMarks</span>(position: .leading)
            }
            .frame(width: <span class="hljs-number">350</span>, height: <span class="hljs-number">300</span>)

            .padding(.horizontal)

            <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Figure 1. Line Chart&quot;</span>)
                .padding()

        }
    }
}
</code></pre>
<h3 id="%E6%8A%8A-chart-%E8%A6%96%E5%9C%96%E5%84%B2%E5%AD%98%E7%82%BA-pdf-%E6%96%87%E4%BB%B6">把 Chart 视图储存为 PDF 文件</h3>
<p>现在，我们想要做的就是使用 <code>ImageRenderer</code>，把 <code>ChartView</code> 储存为 PDF 文件。虽然，我们只需要几行代码就可以把 SwiftUI 视图转换为图像，PDF rendering 就需要多一点步骤。</p>
<p>如果我们是想把 Chart 转换为图像，我们可以存取 <code>uiImage</code> 属性，来取得渲染图像 ( rendered image)。而如果我们想把 Chart 转换成 PDF，就会使用 <code>ImageRenderer</code> 的 <code>render</code> 方法。我们将会实现：</p>
<ul>
<li>寻找文档目录，并为 PDF 文件准备渲染路径 (rendered path)（例如 linechart.pdf）。</li>
<li>准备一个用于绘图的 <code>CGContext</code> 实例。</li>
<li>调用渲染器 (renderer) 的 <code>render</code> 方法来渲染 PDF 文件。</li>
</ul>
<p>在实现中，我们会建立一个新方法 <code>exportPDF</code>。以下是这个方法的代码：</p>
<pre><code class="lang-swift">@<span class="hljs-type">MainActor</span>
private <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">exportPDF</span><span class="hljs-params">()</span> </span>{
    guard <span class="hljs-keyword">let</span> documentDirectory = <span class="hljs-type">FileManager</span>.<span class="hljs-keyword">default</span>.urls(<span class="hljs-keyword">for</span>: .documentDirectory, <span class="hljs-keyword">in</span>: .userDomainMask).first <span class="hljs-keyword">else</span> { <span class="hljs-keyword">return</span> }

    <span class="hljs-keyword">let</span> renderedUrl = documentDirectory.appending(path: <span class="hljs-string">&quot;linechart.pdf&quot;</span>)

    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> consumer = <span class="hljs-type">CGDataConsumer</span>(url: renderedUrl <span class="hljs-keyword">as</span> <span class="hljs-type">CFURL</span>),
       <span class="hljs-keyword">let</span> pdfContext = <span class="hljs-type">CGContext</span>(consumer: consumer, mediaBox: <span class="hljs-built_in">nil</span>, <span class="hljs-built_in">nil</span>) {

        <span class="hljs-keyword">let</span> renderer = <span class="hljs-type">ImageRenderer</span>(content: chartView)
        renderer.render { size, renderer <span class="hljs-keyword">in</span>
            <span class="hljs-keyword">let</span> options: [<span class="hljs-type">CFString</span>: <span class="hljs-type">Any</span>] = [
                kCGPDFContextMediaBox: <span class="hljs-type">CGRect</span>(origin: .zero, size: size)
            ]

            pdfContext.beginPDFPage(options <span class="hljs-keyword">as</span> <span class="hljs-type">CFDictionary</span>)

            renderer(pdfContext)
            pdfContext.endPDFPage()
            pdfContext.closePDF()
        }
    }

    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Saving PDF to <span class="hljs-subst">\(renderedUrl.path()</span>)&quot;</span>)
}
</code></pre>
<p>在代码的前两行，我们检索了使用者的文档目录，并设置 PDF 文件的文件路径（即 <code>line chart.pdf</code>）。然后，我们创建了 <code>CGContext</code> 的实例，并把 <code>mediaBox</code>参数设置为 nil。在这种情况下，Core Graphics 会使用默认页面大小 8.5 x 11 inches（612 x 792 points）。</p>
<p><code>renderer</code> 闭包会接收两个参数：视图当前的大小、和将视图渲染到 <code>CGContext</code> 的函数。让我们调用上下文的 <code>beginPDFPage</code> 方法，来打开 PDF 页面。<code>renderer</code> 方法会绘制 Chart 视图。请记住，我们需要关闭 PDF 文件才能完成整个操作。</p>
<p>让我们要创建一个 <code>PDF</code> 按钮，来调用这个 <code>exportPDF</code> 方法：</p>
<pre><code class="lang-swift"><span class="hljs-type">Button</span> {
    exportPDF()
} label: {
    <span class="hljs-type">Label</span>(<span class="hljs-string">&quot;PDF&quot;</span>, systemImage: <span class="hljs-string">&quot;doc.plaintext&quot;</span>)
}
.buttonStyle(.borderedProminent)
</code></pre>
<p>我们可以试着在模拟器上执行 App 来进行测试，点击 <em>PDF</em> 按钮后，你应该会在控制台看到以下讯息：</p>
<pre><code>Saving PDF to /Users/simon/Library/Developer/CoreSimulator/Devices/CA9B849B-36C5-4608-9D72-B04C468DA87E/data/Containers/Data/Application/04415B8A-7485-48F0-8DA2-59B97C2B529D/Documents/linechart.pdf
</code></pre><p>如果你在 Finder 打开文件，应该会看到以下的 PDF 文件：</p>
<figure id="fig42.2"><img src="images/pdfdoc/swiftui-imagerenderer-pdf-sample.png" alt="图 42.2. PDF 文件"><figcaption>图 42.2. PDF 文件</figcaption></figure>
<p>如果想调整图表的位置，我们可以在调用 <code>renderer</code> 前插入这行代码：</p>
<pre><code class="lang-swift">pdfContext.translateBy(x: <span class="hljs-number">0</span>, y: <span class="hljs-number">200</span>)
</code></pre>
<p>如此一来，图表就会出现在文件上面的部分。</p>
<figure id="fig42.3"><img src="images/pdfdoc/swiftui-imagerenderer-pdf-chart.png" alt="图 42.3. 改变图表的位置"><figcaption>图 42.3. 改变图表的位置</figcaption></figure>
<h2 id="%E5%B0%87-pdf-%E6%AA%94%E5%8A%A0%E8%87%B3-files-app">将 PDF 档加至 Files app</h2>
<p>你可能会发现我们无法在 <em>Files</em> App 中找到 PDF 文件。如果我们想 PDF 文件可用于内置的 <em>Files</em> App，我们就需要在 <code>Info.plist</code> 中更改一些设置。让我们切换到 <code>Info.plist</code> 并添加以下的 key：</p>
<ul>
<li><code>UIFileSharingEnabled</code> - 让 App 支持 iTunes 文件分享</li>
<li><code>LSSupportsOpeningDocumentsInPlace</code> - 支持在本地打开文件</li>
</ul>
<p>然后，把 key 的值设置为 <em>Yes</em>。启用了这两个选项后，让我们再在模拟器上执行 App。接着，打开 <em>Files</em> App 并导航到 <em>On My iPhone</em> 位置，你应该会看到 App 的资料夹，而 PDF 文件就在资料夹中。</p>
<figure id="fig42.4"><img src="images/pdfdoc/swiftui-imagerenderer-pdf-files-app.png" alt="图 42.4. 储存 PDF 档至 Files app"><figcaption>图 42.4. 储存 PDF 档至 Files app</figcaption></figure>
<h3 id="%E7%B8%BD%E7%B5%90">总结</h3>
<p>你不仅可以从视图创建图像，<code>ImageRenderer</code> 还允许开发人员将视图转换为 PDF 文档。 借助 iOS 16 中的这个新 API，你可以轻松地在 iOS 应用程序中添加一些 PDF 相关的功能。</p>
<p>在本章所准备的示例档中，有最后完整的 Xcode 项目，可供你下载参考：</p>
<ul>
<li><a href="https://www.appcoda.com/resources/swiftui4/SwiftUIImageRendererPDF.zip" target="_blank">https://www.appcoda.com/resources/swiftui4/SwiftUIImageRendererPDF.zip</a></li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./swiftui-imagerenderer.html" class="navigation navigation-prev " aria-label="Previous page: 利用 ImageRenderer API 轻松把 SwiftUI 视图转换为图像"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./swiftui-gauge.html" class="navigation navigation-next " aria-label="Next page: 使用 Gauge 视图显示进度并创建速度计"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":"white","family":"serif","size":3},"image-captions":{"caption":"_CAPTION_","variable_name":"_pictures"}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
