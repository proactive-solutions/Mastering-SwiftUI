<!DOCTYPE HTML>
<html lang="zh-tw" >
    
    <head>
        
        <meta charset=utf-8"UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>基础动画与转场 | 精通 SwiftUI - iOS 16 版</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.1">
        <meta name="author" content="Simon Ng">
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="./swiftui-list.html" />
    
    
    <link rel="prev" href="./swiftui-path-shape.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-image-captions/image-captions.css">
        
    
    
        <link rel="stylesheet" href="././styles/website.css">
    

        
    <div class="book" data-level="9" data-basepath="." data-revision="Thu Dec 01 2022 17:36:55 GMT+0800 (HKT)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="输入并搜寻" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
            
            <li>
                <a href="https://www.appcoda.com.tw" target="blank" class="custom-link">Made by AppCoda</a>
            </li>
        
            
            <li>
                <a href="https://www.appcoda.com.tw/contact" target="blank" class="custom-link">Contact us / Support</a>
            </li>
        
            
            <li>
                <a href="http://twitter.com/share?text=Mastering%20SwiftUI%20via%20@appcodamobile&amp;url=https://www.appcoda.com.tw/swiftui/&amp;hashtags=swiftlang" target="blank" class="custom-link">Tweet this book</a>
            </li>
        
        

        
        <li class="divider"></li>
        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                        序言
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="swiftui-basics.html">
            
                
                    <a href="./swiftui-basics.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        SwiftUI 介绍
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="swiftui-text.html">
            
                
                    <a href="./swiftui-text.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        SwiftUI 入门 - 文字的处理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="swiftui-images.html">
            
                
                    <a href="./swiftui-images.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        图片的处理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="swiftui-stacks.html">
            
                
                    <a href="./swiftui-stacks.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        以堆叠布局使用者介面
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="swiftui-scrollview.html">
            
                
                    <a href="./swiftui-scrollview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        ScrollView 与 Carousel UI 的建立
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="swiftui-buttons.html">
            
                
                    <a href="./swiftui-buttons.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        SwiftUI 按钮与渐层
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="swiftui-state.html">
            
                
                    <a href="./swiftui-state.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        状态(State)与绑定(Binding)
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="swiftui-path-shape.html">
            
                
                    <a href="./swiftui-path-shape.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        实作路径(Path)与形状(Shape)来画线与圆饼图
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="9" data-path="swiftui-animation.html">
            
                
                    <a href="./swiftui-animation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        基础动画与转场
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="swiftui-list.html">
            
                
                    <a href="./swiftui-list.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        动态列表、 ForEach 与 Identifiable 的使用方法
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="swiftui-navigation.html">
            
                
                    <a href="./swiftui-navigation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        导览UI与导览列客制化运用
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="swiftui-modal.html">
            
                
                    <a href="./swiftui-modal.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        强制回应视图、浮动按钮与提示的实作
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="swiftui-form.html">
            
                
                    <a href="./swiftui-form.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        以选取器(Picker)、开关(Toggle)与步进器(Stepper)来建立一个表单
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="swiftui-form-data.html">
            
                
                    <a href="./swiftui-form-data.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        使用 Combine 与 Environment 物件进行资料分享
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="swiftui-form-registration.html">
            
                
                    <a href="./swiftui-form-registration.html">
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        以 Combine 与 视图模型建立一个注册表单
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="swiftui-actionsheet-context.html">
            
                
                    <a href="./swiftui-actionsheet-context.html">
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        滑动删除、内容选单与动作列表
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="swiftui-gestures.html">
            
                
                    <a href="./swiftui-gestures.html">
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        认识手势（Gestures）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="swiftui-bottom-sheet.html">
            
                
                    <a href="./swiftui-bottom-sheet.html">
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        以SwiftUI 手势与 GeometryReader 建立一个底部展开式页面
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="swiftui-trip-tinder.html">
            
                
                    <a href="./swiftui-trip-tinder.html">
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        使用手势与动画建立 Tinder 风格的 UI
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="swiftui-advanced-animations.html">
            
                
                    <a href="./swiftui-advanced-animations.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        建立像 Apple Wallet App 的动画和转场效果
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="swiftui-json.html">
            
                
                    <a href="./swiftui-json.html">
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        JSON、滑杆的运用与资料过滤
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="swiftui-core-data.html">
            
                
                    <a href="./swiftui-core-data.html">
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        如何使用 Core Data 建立 ToDo App
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="swiftui-uikit.html">
            
                
                    <a href="./swiftui-uikit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        利用 UIViewRepresentable 整合UIKit 组件
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="24" data-path="swiftui-searchbar.html">
            
                
                    <a href="./swiftui-searchbar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        建立搜寻栏视图并使用自订绑定（Custom Binding）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="swiftui-real-world-app.html">
            
                
                    <a href="./swiftui-real-world-app.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        把所学应用出来！构建个人理财App
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="26" data-path="swiftui-appstoreanimation.html">
            
                
                    <a href="./swiftui-appstoreanimation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                        创建类似App Store使用的动画视图转换
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="27" data-path="swiftui-carousel.html">
            
                
                    <a href="./swiftui-carousel.html">
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                        如何建立图像轮播（Image Carousel）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="28" data-path="swiftui-expandable-list.html">
            
                
                    <a href="./swiftui-expandable-list.html">
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                        如何建立展开式列表视图和大纲视图
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="29" data-path="swiftui-gridlayout.html">
            
                
                    <a href="./swiftui-gridlayout.html">
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                        使用 LazyVGrid 和 LazyHGrid 构建集合视图
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="30" data-path="swiftui-progress-ring.html">
            
                
                    <a href="./swiftui-progress-ring.html">
                        <i class="fa fa-check"></i>
                        
                            <b>30.</b>
                        
                        使用 Shape 和 Animatable 开发带动画的环形进度条
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="31" data-path="swiftui-library.html">
            
                
                    <a href="./swiftui-library.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.</b>
                        
                        如何使用 AnimatableModifier 和 LibraryContentProvider
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="32" data-path="swiftui-texteditor.html">
            
                
                    <a href="./swiftui-texteditor.html">
                        <i class="fa fa-check"></i>
                        
                            <b>32.</b>
                        
                        使用 TextEditor 支援多行文字输入
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="33" data-path="swiftui-matchedgeometry.html">
            
                
                    <a href="./swiftui-matchedgeometry.html">
                        <i class="fa fa-check"></i>
                        
                            <b>33.</b>
                        
                        使用 matchedGeometryEffect为 App 建立绚丽的视图动画
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="34" data-path="swiftui-grid-animation.html">
            
                
                    <a href="./swiftui-grid-animation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>34.</b>
                        
                        ScrollViewReader 和网格动画
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="35" data-path="swiftui-tabview.html">
            
                
                    <a href="./swiftui-tabview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>35.</b>
                        
                        标签视图的运用与自订标签列
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="36" data-path="swiftui-asyncimage.html">
            
                
                    <a href="./swiftui-asyncimage.html">
                        <i class="fa fa-check"></i>
                        
                            <b>36.</b>
                        
                        利用 AsyncImage 非同步加载和显示图像
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="37" data-path="swiftui-searchable.html">
            
                
                    <a href="./swiftui-searchable.html">
                        <i class="fa fa-check"></i>
                        
                            <b>37.</b>
                        
                        利用 Searchable 建立搜寻栏
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="38" data-path="swiftui-charts.html">
            
                
                    <a href="./swiftui-charts.html">
                        <i class="fa fa-check"></i>
                        
                            <b>38.</b>
                        
                        利用 Charts 框架建立图表
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="39" data-path="swiftui-live-text.html">
            
                
                    <a href="./swiftui-live-text.html">
                        <i class="fa fa-check"></i>
                        
                            <b>39.</b>
                        
                        利用 Live Text API 从图片中撷取文本
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="40" data-path="swiftui-sharelink.html">
            
                
                    <a href="./swiftui-sharelink.html">
                        <i class="fa fa-check"></i>
                        
                            <b>40.</b>
                        
                        透过 ShareLink 来分享文本和图像等资料
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="41" data-path="swiftui-imagerenderer.html">
            
                
                    <a href="./swiftui-imagerenderer.html">
                        <i class="fa fa-check"></i>
                        
                            <b>41.</b>
                        
                        利用 ImageRenderer API 轻松把 SwiftUI 视图转换为图像
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="42" data-path="swiftui-pdf-doc.html">
            
                
                    <a href="./swiftui-pdf-doc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>42.</b>
                        
                        如何把 SwiftUI 视图转换为 PDF 文件
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="43" data-path="swiftui-gauge.html">
            
                
                    <a href="./swiftui-gauge.html">
                        <i class="fa fa-check"></i>
                        
                            <b>43.</b>
                        
                        使用 Gauge 视图显示进度并创建速度计
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="44" data-path="swiftui-grid.html">
            
                
                    <a href="./swiftui-grid.html">
                        <i class="fa fa-check"></i>
                        
                            <b>44.</b>
                        
                        使用Grid API 创建网格布局
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="45" data-path="swiftui-anylayout.html">
            
                
                    <a href="./swiftui-anylayout.html">
                        <i class="fa fa-check"></i>
                        
                            <b>45.</b>
                        
                        利用 AnyLayout 切换 UI 布局
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="46" data-path="swiftui-navigationstack.html">
            
                
                    <a href="./swiftui-navigationstack.html">
                        <i class="fa fa-check"></i>
                        
                            <b>46.</b>
                        
                        使用新的 NavigationStack 视图构建资料导向的导航
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                本书使用 GitBook 释出
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="目录"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="搜寻"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="字型设定"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">衬线体</button>
        <button type="button" data-font="1" class="button">无衬线体</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">白色</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">棕褐色</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">夜间</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="分享"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    分享到 Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    分享到 Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    分享到 Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    分享到 Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    分享到 Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >精通 SwiftUI - iOS 16 版</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="%E7%AC%AC-9-%E7%AB%A0-br-%E5%9F%BA%E7%A4%8E%E5%8B%95%E7%95%AB%E8%88%87%E8%BD%89%E5%A0%B4">第 9 章<br>基础动画与转场</h1>
<p>你曾在 Keynote 使用过瞬间移动动画（ magic move animation ）吗？藉由瞬间移动效果， 你可以轻松建立投影片间的平滑动画（ slick animation ）。Keynote 会自动分析两张投影片之间的物件，并自动渲染动画。同样，SwiftUI 也将瞬间移动动画带入应用程式开发中， 使用该框架的动画是自动且神奇的。当你定义一个视图的两个状态，SwiftUI 会找出其余的状态，接着以动画呈现两个状态之间的变化。</p>
<p>SwiftUI 使你能够为单个视图的变化以及两个视图之间的转场来设定动画。SwiftUI 框架具有许多的内建动画，可建立不同的效果。</p>
<h3 id="%E9%9A%B1%E5%BC%8F%E5%8B%95%E7%95%AB%E8%88%87%E9%A1%AF%E5%BC%8F%E5%8B%95%E7%95%AB">隐式动画与显式动画</h3>
<p>SwiftUI 提供两种动画类型：隐式（ implicit ）与显式（ explicit ）。这两个方式可以让你为视图及视图转场设定动画。为了实作隐式动画，SwiftUI 框架提供一个名为 <code>animation</code> 的修饰器，你把这个修饰器加到要设定动画的视图上，并指定喜欢的动画类型。或者，你可以定义动画的持续时间与延迟时间，SwiftUI 会根据视图的状态变化来自动渲染动画。</p>
<p>显式动画对你要显示的动画提供更具局限性的控制，其并非将修饰器加到视图，而是在 <code>withAnimation()</code> 区块中，告诉 SwiftUI 若有什么的状态变化时，要绘制动画。</p>
<p>仍是觉得有些困惑吗？没有关系，藉由几个范例，你就会更有概念了。</p>
<h4 id="%E9%9A%B1%E5%BC%8F%E5%8B%95%E7%95%AB">隐式动画</h4>
<p>我们从隐式动画来开始介绍，我建议你建立一个新专案来看动画的实际效果。你可以任意为专案命名，而我将它命名为 <code>SwiftUIAnimation</code>。</p>
<figure id="fig9.1"><img src="images/animation/swiftui-animation-1.png" alt="图 9.1. 绘制按钮的状态变化"><figcaption>图 9.1. 绘制按钮的状态变化</figcaption></figure>
<p>我们来看图 9.1，这是一个简单的可点击视图，由红色圆形与心形所组成。当使用者点击心形或圆形时，圆形的颜色会变成淡灰色，而心形则会变成红色，同时心形图示的大小也变得较大。因此，以下是其状态变化： </p>
<ol>
<li>圆的颜色会从红色变成淡灰色。</li>
<li>心形图示的颜色会从白色变成红色。</li>
<li>心形图示会比原来的大小大两倍。</li>
</ol>
<p>如果你使用SwiftUI 来实作可点击的圆形，以下为程式内容，你可以建立一个 Xcode 的新专案，并将程式插入至 <code>ContentView.swift</code> 来测试看看：</p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> circleColorChanged = <span class="hljs-built_in">false</span>
    @<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> heartColorChanged = <span class="hljs-built_in">false</span>
    @<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> heartSizeChanged = <span class="hljs-built_in">false</span>

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {

        <span class="hljs-type">ZStack</span> {
            <span class="hljs-type">Circle</span>()
                .frame(width: <span class="hljs-number">200</span>, height: <span class="hljs-number">200</span>)
                .foregroundColor(circleColorChanged ? <span class="hljs-type">Color</span>(.systemGray5) : .red)

            <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;heart.fill&quot;</span>)
                .foregroundColor(heartColorChanged ? .red : .white)
                .font(.system(size: <span class="hljs-number">100</span>))
                .scaleEffect(heartSizeChanged ? <span class="hljs-number">1.0</span> : <span class="hljs-number">0.5</span>)
        }
        .onTapGesture {
            circleColorChanged.toggle()
            heartColorChanged.toggle()
            heartSizeChanged.toggle()
        }

    }
}
</code></pre>
<p>我们定义三个状态变数来建立状态模型，初始值皆设定为“false”。为了建立圆形与心形，我们使用 <code>ZStack</code> 来将心形叠在圆形上，如图9.2 所示。SwiftUI 有个 <code>onTapGesture</code> 修饰器可以侦测，点击手势，你可以将它加在任何视图，使其可点击。在 <code>onTapGesture</code> 闭包中，我们切换状态，以改变视图的外观。</p>
<figure id="fig9.2"><img src="images/animation/swiftui-animation-2.png" alt="图 9.2.　实作圆形与心形视图"><figcaption>图 9.2.　实作圆形与心形视图</figcaption></figure>
<p>在预览画布测试这个 App，则你点击视图时，圆形及心形图示的颜色会改变，但这些变化不会显示动画。</p>
<p>要让这些变化显示动画效果，你只需将 <code>animation</code> 修饰器加到 <code>Circle</code> 与 <code>Image</code> 视图： </p>
<pre><code class="lang-swift"><span class="hljs-type">Circle</span>()
    .frame(width: <span class="hljs-number">200</span>, height: <span class="hljs-number">200</span>)
    .foregroundColor(circleColorChanged ? <span class="hljs-type">Color</span>(.systemGray5) : .red)
    .animation(.<span class="hljs-keyword">default</span>, value: circleColorChanged)

<span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;heart.fill&quot;</span>)
    .foregroundColor(heartColorChanged ? .red : .white)
    .font(.system(size: <span class="hljs-number">100</span>))
    .scaleEffect(heartSizeChanged ? <span class="hljs-number">1.0</span> : <span class="hljs-number">0.5</span>)
    .animation(.<span class="hljs-keyword">default</span>, value: heartSizeChanged)
</code></pre>
<p>SwiftUI 会自动计算与渲染动画，使视图可以从一个状态流畅转换到另一个状态。再次点击心形，你会见到一个平滑动画。</p>
<p>你不仅可以将 <code>animation</code> 修饰器应用到单一视图中，还可应用于一组视图。举例而言， 你可以将 <code>animation</code> 修饰器加到 <code>ZStack</code>，将上列的代码重新撰写如下：</p>
<pre><code class="lang-swift"><span class="hljs-type">ZStack</span> {
    <span class="hljs-type">Circle</span>()
        .frame(width: <span class="hljs-number">200</span>, height: <span class="hljs-number">200</span>)
        .foregroundColor(circleColorChanged ? <span class="hljs-type">Color</span>(.systemGray5) : .red)

    <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;heart.fill&quot;</span>)
        .foregroundColor(heartColorChanged ? .red : .white)
        .font(.system(size: <span class="hljs-number">100</span>))
        .scaleEffect(heartSizeChanged ? <span class="hljs-number">1.0</span> : <span class="hljs-number">0.5</span>)
}
.animation(.<span class="hljs-keyword">default</span>, value: circleColorChanged)
.animation(.<span class="hljs-keyword">default</span>, value: heartSizeChanged)
.onTapGesture {
    <span class="hljs-keyword">self</span>.circleColorChanged.toggle()
    <span class="hljs-keyword">self</span>.heartColorChanged.toggle()
    <span class="hljs-keyword">self</span>.heartSizeChanged.toggle()
}
</code></pre>
<p>其工作原理是完全相同的，SwiftUI 寻找嵌入在 <code>ZStack</code> 中所有的状态变化，并建立动画。</p>
<p>在范例中，我们使用预设动画。SwiftUI 提供许多内建动画供你选择，包括 <code>linear</code>、<code>easeIn</code>、<code>easeOut</code>、<code>easeInOut</code> 与 <code>spring</code>。“线性动画”（linear animation ）是以线性速度来呈现变化，而“缓动动画”（easing animation ）则是速度会做变化。详细内容可以参考 www.easings.net 来了解每个 ease 函数的差异。</p>
<p>要使用其他的动画，你只需要在 <code>animation</code> 修饰器中设定特定的动画。例如：你想要使用 <code>spring</code> 动画，则可以将 <code>.default</code> 更改如下： </p>
<pre><code class="lang-swift">.animation(.spring(response: <span class="hljs-number">0.3</span>, dampingFraction: <span class="hljs-number">0.3</span>, blendDuration: <span class="hljs-number">0.3</span>), value: circleColorChanged)
</code></pre>
<p>这会渲染一个基于弹簧特性的动画，使得心形产生心跳的效果。你可以调整阻尼（damping ）值与混合（blend ）值，来达到不同的效果。</p>
<h4 id="%E9%A1%AF%E5%BC%8F%E5%8B%95%E7%95%AB">显式动画</h4>
<p>以上是对视图使用隐式动画的方法。我们来看如何使用显式动画来达到相同的结果。如前所述，你需要将状态变化包裹在 <code>withAnimation</code> 区块内。要建立相同的动画效果，你可撰写下列代码：</p>
<pre><code class="lang-swift"><span class="hljs-type">ZStack</span> {
    <span class="hljs-type">Circle</span>()
        .frame(width: <span class="hljs-number">200</span>, height: <span class="hljs-number">200</span>)
        .foregroundColor(circleColorChanged ? <span class="hljs-type">Color</span>(.systemGray5) : .red)

    <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;heart.fill&quot;</span>)
        .foregroundColor(heartColorChanged ? .red : .white)
        .font(.system(size: <span class="hljs-number">100</span>))
        .scaleEffect(heartSizeChanged ? <span class="hljs-number">1.0</span> : <span class="hljs-number">0.5</span>)
}
.onTapGesture {
    withAnimation(.<span class="hljs-keyword">default</span>) {
        <span class="hljs-keyword">self</span>.circleColorChanged.toggle()
        <span class="hljs-keyword">self</span>.heartColorChanged.toggle()
        <span class="hljs-keyword">self</span>.heartSizeChanged.toggle()
    }
}
</code></pre>
<p>我们不再使用 <code>animation</code> 修饰器，而是使用 <code>withAnimation</code> 包裹在 <code>onTapGesture</code> 中。<code>withAnimation</code> 调用带入一个动画参数，这里我们指定使用预设动画。</p>
<p>当然，你可更新 <code>withAnimation</code>，以将动画变更为弹簧动画，如下所示： </p>
<pre><code class="lang-swift">withAnimation(.spring(response: <span class="hljs-number">0.3</span>, dampingFraction: <span class="hljs-number">0.3</span>, blendDuration: <span class="hljs-number">0.3</span>)) {
    <span class="hljs-keyword">self</span>.circleColorChanged.toggle()
    <span class="hljs-keyword">self</span>.heartColorChanged.toggle()
    <span class="hljs-keyword">self</span>.heartSizeChanged.toggle()
}
</code></pre>
<p>使用显式动画，你可以轻松控制想加上动画的状态。举例而言，如果你不想为心形图示的大小变化设定动画时，则可以从 <code>withAnimation</code> 排除该行代码，如下所示： </p>
<pre><code class="lang-swift">.onTapGesture {
    withAnimation(.spring(response: <span class="hljs-number">0.3</span>, dampingFraction: <span class="hljs-number">0.3</span>, blendDuration: <span class="hljs-number">0.3</span>)) {
        <span class="hljs-keyword">self</span>.circleColorChanged.toggle()
        <span class="hljs-keyword">self</span>.heartColorChanged.toggle()
    }

    <span class="hljs-keyword">self</span>.heartSizeChanged.toggle()
}
</code></pre>
<p>在这个情况下，SwiftUI 将只对圆形与心形的颜色变化设定动画，你不会再看到心形图示的变大动画效果。</p>
<p>你可能想知道我们是否可以使用隐式动画来关闭缩放动画。好的，你仍然可以做到， 可重新调整 <code>.animation</code> 的顺序，以防止 SwiftUI 对特定状态变化设定动画。下列为达到相同效果的程式： </p>
<pre><code class="lang-swift"><span class="hljs-type">ZStack</span> {
    <span class="hljs-type">Circle</span>()
        .frame(width: <span class="hljs-number">200</span>, height: <span class="hljs-number">200</span>)
        .foregroundColor(circleColorChanged ? <span class="hljs-type">Color</span>(.systemGray5) : .red)
        .animation(.spring(response: <span class="hljs-number">0.3</span>, dampingFraction: <span class="hljs-number">0.3</span>, blendDuration: <span class="hljs-number">0.3</span>), value: circleColorChanged)

    <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;heart.fill&quot;</span>)
        .foregroundColor(heartColorChanged ? .red : .white)
        .font(.system(size: <span class="hljs-number">100</span>))
        .animation(.spring(response: <span class="hljs-number">0.3</span>, dampingFraction: <span class="hljs-number">0.3</span>, blendDuration: <span class="hljs-number">0.3</span>), value: heartColorChanged)
        .scaleEffect(heartSizeChanged ? <span class="hljs-number">1.0</span> : <span class="hljs-number">0.5</span>)
}
.onTapGesture {
    <span class="hljs-keyword">self</span>.circleColorChanged.toggle()
    <span class="hljs-keyword">self</span>.heartColorChanged.toggle()
    <span class="hljs-keyword">self</span>.heartSizeChanged.toggle()
}
</code></pre>
<p>对于 Image 视图，我们在 scaleEffect 之前置入 <code>animation(nil)</code> 修饰器，这会将动画取消，<code>scaleEffect</code> 修饰器的状态变化将不会设定动画。</p>
<p>虽然你可以使用隐式动画建立相同的动画，但我认为在这种情况下，使用显式动画会更方便。</p>
<h3 id="%E4%BD%BF%E7%94%A8rotationeffect-%E5%BB%BA%E7%AB%8B%E4%B8%8B%E8%BC%89%E6%8C%87%E7%A4%BA%E5%99%A8">使用RotationEffect 建立下载指示器</h3>
<p>SwiftUI 动画的强大之处在于，你不需关心如何对视图设定动画，你只需要提供起始与结束状态，接着 SwiftUI 会找出其余的状态。当你具备了这个观念，即可以建立各种类型的动画。</p>
<figure id="fig9.3"><img src="images/animation/swiftui-animation-3.gif" alt="图 9.3.　下载指示器范例"><figcaption>图 9.3.　下载指示器范例</figcaption></figure>
<p>举例而言，我们来建立一个简单的下载指示器，你通常可以在一些真实世界的应用程式（如 Medium）中找到它。要建立一个如图 9.3 所示的下载指示器，我们从开放式圆环（open ended circle ）来开始，如下所示： </p>
<pre><code class="lang-swift"><span class="hljs-type">Circle</span>()
    .trim(from: <span class="hljs-number">0</span>, to: <span class="hljs-number">0.7</span>)
    .stroke(<span class="hljs-type">Color</span>.green, lineWidth: <span class="hljs-number">5</span>)
    .frame(width: <span class="hljs-number">100</span>, height: <span class="hljs-number">100</span>)
</code></pre>
<p>那么，我们如何使圆环连续旋转呢？我们可以利用 <code>rotationEffect</code> 与 <code>animation</code> 修饰器。诀窍就是使圆环 360 度连续旋转。以下为代码： </p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> isLoading = <span class="hljs-built_in">false</span>

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">Circle</span>()
            .trim(from: <span class="hljs-number">0</span>, to: <span class="hljs-number">0.7</span>)
            .stroke(<span class="hljs-type">Color</span>.green, lineWidth: <span class="hljs-number">5</span>)
            .frame(width: <span class="hljs-number">100</span>, height: <span class="hljs-number">100</span>)
            .rotationEffect(<span class="hljs-type">Angle</span>(degrees: isLoading ? <span class="hljs-number">360</span> : <span class="hljs-number">0</span>))
            .animation(.<span class="hljs-keyword">default</span>.repeatForever(autoreverses: <span class="hljs-built_in">false</span>), value: isLoading)
            .onAppear() {
                isLoading = <span class="hljs-built_in">true</span>
            }
    }
}
</code></pre>
<p><code>rotationEffect</code> 修饰器带入旋转角度，在上列的代码中，我们有一个状态变数来控制下载状态。当它设定为true 时，这个旋转角度设定为 360 度以旋转圆环。在 <code>animation</code> 修饰器中，我们指定使用预设动画，不过还有些不同，我们告诉 SwiftUI 要一次又一次重复相同的动画，这就是建立下载动画的诀窍。</p>
<p><strong>*备注</strong>: 如果在预览画布中看不到动画，请在模拟器中运行App再试一试。*</p>
<p>如果你想要更改动画的速度，则可以使用线性动画，并指定持续时间，如下所示：</p>
<pre><code class="lang-swift">.animation(.linear(duration: <span class="hljs-number">5</span>).repeatForever(autoreverses: <span class="hljs-built_in">false</span>), value: isLoading)
</code></pre>
<p>持续时间越久，则动画越慢。</p>
<p><code>onAppear</code> 修饰器对你而言可能比较陌生，如果你对 UIKit 有所了解的话，这个修饰器和 <code>viewDidAppear</code> 非常相似，当视图出现在画面上时会自动调用。在该代码中，我们将下载状态设定为true，以在视图载入时启动动画。</p>
<p>当你使用此技术，就可以调整设计并开发各种版本的下载指示器。举例而言，你可以将圆弧叠在圆环上，以建立精美的下载指示器，如图 9.4 所示。</p>
<figure id="fig9.4"><img src="images/animation/swiftui-animation-4.gif" alt="图 9.4.　下载指示器范例"><figcaption>图 9.4.　下载指示器范例</figcaption></figure>
<p>代码片段如下所示： </p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>: <span class="hljs-title">View</span> </span>{

    @<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> isLoading = <span class="hljs-built_in">false</span>

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">ZStack</span> {

            <span class="hljs-type">Circle</span>()
                .stroke(<span class="hljs-type">Color</span>(.systemGray5), lineWidth: <span class="hljs-number">14</span>)
                .frame(width: <span class="hljs-number">100</span>, height: <span class="hljs-number">100</span>)

            <span class="hljs-type">Circle</span>()
                .trim(from: <span class="hljs-number">0</span>, to: <span class="hljs-number">0.2</span>)
                .stroke(<span class="hljs-type">Color</span>.green, lineWidth: <span class="hljs-number">7</span>)
                .frame(width: <span class="hljs-number">100</span>, height: <span class="hljs-number">100</span>)
                .rotationEffect(<span class="hljs-type">Angle</span>(degrees: isLoading ? <span class="hljs-number">360</span> : <span class="hljs-number">0</span>))
                .animation(.linear(duration: <span class="hljs-number">1</span>).repeatForever(autoreverses: <span class="hljs-built_in">false</span>), value: isLoading)
                .onAppear() {
                    <span class="hljs-keyword">self</span>.isLoading = <span class="hljs-built_in">true</span>
            }
        }
    }
}
</code></pre>
<p>下载指示器不需要为圆形，你也可以使用 <code>Rectangle</code> 或 <code>RoundedRectangle</code> 来建立该指示器。不过，无需更改旋转角度，你可以修改位移值（offset value）来建立如图 9.5 所示的动画。</p>
<figure id="fig9.5"><img src="images/animation/swiftui-animation-5.gif" alt="图 9.5.　下载指示器的另一个范例"><figcaption>图 9.5.　下载指示器的另一个范例</figcaption></figure>
<p>为了建立动画，我们将两个圆角矩形重叠在一起。上面的矩形比下面的矩形短得多， 当开始载入时，我们将位移值从“-110”更新为“110”。</p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>: <span class="hljs-title">View</span> </span>{

    @<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> isLoading = <span class="hljs-built_in">false</span>

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">ZStack</span> {

            <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Loading&quot;</span>)
                .font(.system(.body, design: .rounded))
                .bold()
                .offset(x: <span class="hljs-number">0</span>, y: -<span class="hljs-number">25</span>)

            <span class="hljs-type">RoundedRectangle</span>(cornerRadius: <span class="hljs-number">3</span>)
                .stroke(<span class="hljs-type">Color</span>(.systemGray5), lineWidth: <span class="hljs-number">3</span>)
                .frame(width: <span class="hljs-number">250</span>, height: <span class="hljs-number">3</span>)

            <span class="hljs-type">RoundedRectangle</span>(cornerRadius: <span class="hljs-number">3</span>)
                .stroke(<span class="hljs-type">Color</span>.green, lineWidth: <span class="hljs-number">3</span>)
                .frame(width: <span class="hljs-number">30</span>, height: <span class="hljs-number">3</span>)
                .offset(x: isLoading ? <span class="hljs-number">110</span> : -<span class="hljs-number">110</span>, y: <span class="hljs-number">0</span>)
                .animation(.linear(duration: <span class="hljs-number">1</span>).repeatForever(autoreverses: <span class="hljs-built_in">false</span>), value: isLoading)
        }
        .onAppear() {
            <span class="hljs-keyword">self</span>.isLoading = <span class="hljs-built_in">true</span>
        }
    }
}
</code></pre>
<p>这会让绿色矩形沿着线条移动。而且，当你一次又一次重复相同的动画，它将变成一个载入动画，图 9.6 说明了位移值。</p>
<figure id="fig9.6"><img src="images/animation/swiftui-animation-6.png" alt="图 9.6.　下载指示器的另一个范例"><figcaption>图 9.6.　下载指示器的另一个范例</figcaption></figure>
<h3 id="%E5%BB%BA%E7%AB%8B%E9%80%B2%E5%BA%A6%E6%8C%87%E7%A4%BA%E5%99%A8">建立进度指示器</h3>
<p>下载指示器向使用者提供一些回馈，其表示 App 正在处理某些事情。不过，它并没有显示实际进度，如果你需要为使用者提供关于任务进度的更多资讯，则可能需要建立一个如图 9.7 所示的进度指示器。</p>
<figure id="fig9.7"><img src="images/animation/swiftui-animation-7.gif" alt="图 9.7.　进度指示器"><figcaption>图 9.7.　进度指示器</figcaption></figure>
<p>建立进度指示器的方式与下载指示器非常相似。不过，你需要使用状态变数来追踪进度。以下是建立进度指示器的代码片段： </p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> progress: <span class="hljs-type">CGFloat</span> = <span class="hljs-number">0.0</span>

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {

        <span class="hljs-type">ZStack</span> {    
            <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;<span class="hljs-subst">\(Int(progress * <span class="hljs-number">100</span>)</span>)%&quot;</span>)
                .font(.system(.title, design: .rounded))
                .bold()

            <span class="hljs-type">Circle</span>()
                .stroke(<span class="hljs-type">Color</span>(.systemGray5), lineWidth: <span class="hljs-number">10</span>)
                .frame(width: <span class="hljs-number">150</span>, height: <span class="hljs-number">150</span>)

            <span class="hljs-type">Circle</span>()
                .trim(from: <span class="hljs-number">0</span>, to: progress)
                .stroke(<span class="hljs-type">Color</span>.green, lineWidth: <span class="hljs-number">10</span>)
                .frame(width: <span class="hljs-number">150</span>, height: <span class="hljs-number">150</span>)
                .rotationEffect(<span class="hljs-type">Angle</span>(degrees: -<span class="hljs-number">90</span>))
        }
        .onAppear() {
            <span class="hljs-type">Timer</span>.scheduledTimer(withTimeInterval: <span class="hljs-number">0.5</span>, repeats: <span class="hljs-built_in">true</span>) { timer <span class="hljs-keyword">in</span>
                <span class="hljs-keyword">self</span>.progress += <span class="hljs-number">0.05</span>
                <span class="hljs-built_in">print</span>(<span class="hljs-keyword">self</span>.progress)
                <span class="hljs-keyword">if</span> <span class="hljs-keyword">self</span>.progress &gt;= <span class="hljs-number">1.0</span> {
                    timer.invalidate()
                }
            }
        }
    }
}
</code></pre>
<p>这里的状态变数不是使用布林值，而是我们使用浮点数来储存状态。为了显示进度， 我们以进度值来设定 <code>trim</code> 修饰器。在真实世界的应用程式中，你可以更新 <code>progress</code> 的值来显示操作的实际进度。为了示范，我们只启用一个计时器，其每半秒更新一次。</p>
<h3 id="%E5%BB%B6%E9%81%B2%E5%8B%95%E7%95%AB">延迟动画</h3>
<p>SwiftUI 框架不只让你可以控制动画的持续时间，你可以透过 <code>delay</code> 函数来延迟动画， 如下所示： </p>
<pre><code class="lang-swift"><span class="hljs-type">Animation</span>.<span class="hljs-keyword">default</span>.delay(<span class="hljs-number">1.0</span>)
</code></pre>
<p>这会将动画延迟1 秒后开始。<code>delay</code> 函数也适用其他动画。</p>
<p>透过混合搭配持续时间值与延迟时间值，你可以实作出一些有趣的动画，如图 9.8 所示的圆点下载指示器。</p>
<figure id="fig9.8"><img src="images/animation/swiftui-animation-8.gif" alt="图 9.8.　圆点下载指示器r"><figcaption>图 9.8.　圆点下载指示器r</figcaption></figure>
<p>这个指示器由五个点组成，每个点皆有放大缩小动画，不过各有不同的延迟时间。我们来看代码该如何实作： </p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> isLoading = <span class="hljs-built_in">false</span>

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">HStack</span> {
            <span class="hljs-type">ForEach</span>(<span class="hljs-number">0</span>...<span class="hljs-number">4</span>, id: \.<span class="hljs-keyword">self</span>) { index <span class="hljs-keyword">in</span>
                <span class="hljs-type">Circle</span>()
                    .frame(width: <span class="hljs-number">10</span>, height: <span class="hljs-number">10</span>)
                    .foregroundColor(.green)
                    .scaleEffect(<span class="hljs-keyword">self</span>.isLoading ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>)
                    .animation(.linear(duration: <span class="hljs-number">0.6</span>).repeatForever().delay(<span class="hljs-number">0.2</span> * <span class="hljs-type">Double</span>(index)), value: isLoading)
            }
        }
        .onAppear() {
            <span class="hljs-keyword">self</span>.isLoading = <span class="hljs-built_in">true</span>
        }
    }
}
</code></pre>
<p>我们先使用一个 <code>HStack</code> 来水平布局这些圆形，由于这五个圆形（也就是点）皆有相同的大小与颜色，因此我们使用 <code>ForEach</code> 来建立这些圆形。<code>scaleEffect</code> 修饰器是用来缩放圆形的大小，预设是设定为“1”，也就是原来的大小。当开始载入时，该值会更新为“0”， 这将会缩小此点。</p>
<p>用于渲染动画的代码看起来有些复杂，我们来分拆它并逐步研究： </p>
<pre><code class="lang-swift"><span class="hljs-type">Animation</span>.linear(duration: <span class="hljs-number">0.6</span>).repeatForever().delay(<span class="hljs-number">0.2</span> * <span class="hljs-type">Double</span>(index))
</code></pre>
<p>第一个部分建立一个持续时间为 0.6 秒的线性动画，该动画会重复执行，因此我们调用 <code>repeatForever</code> 函数。</p>
<p>如果你没有调用 <code>delay</code> 函数来执行这个动画，则所有的点会同时缩放。但是，这不是我们想要的结果，每个点应独立调整大小，而不是全部同时放大/ 缩小，这也是为何我们调用 <code>delay</code> 函数的原因，并对每个点使用不同的延迟时间值。</p>
<p>你可以更改持续时间值与延迟时间值来调整动画。</p>
<h3 id="%E5%B0%87%E7%9F%A9%E5%BD%A2%E8%AE%8A%E5%BD%A2%E7%82%BA%E5%9C%93%E5%BD%A2">将矩形变形为圆形</h3>
<p>有时，你可能需要将一个形状（例如：矩形）流畅地变形为另一个形状（例如：圆形）。这该如何实作呢？使用内建的形状与动画，你可以轻松建立如图 9.9 所示的变形。</p>
<figure id="fig9.9"><img src="images/animation/swiftui-animation-9.gif" alt="图 9.9.　将矩形变形为圆形"><figcaption>图 9.9.　将矩形变形为圆形</figcaption></figure>
<p>将矩形变形为圆形的技巧是使用 <code>RoundedRectangle</code> 形状，并为圆角半径的变化设定动画。假设矩形的宽度与高度相同，当圆角半径设定为宽度的一半时，它会变为圆形。以下是变形按钮的实作： </p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> recordBegin = <span class="hljs-built_in">false</span>
    @<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> recording = <span class="hljs-built_in">false</span>

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">ZStack</span> {

            <span class="hljs-type">RoundedRectangle</span>(cornerRadius: recordBegin ? <span class="hljs-number">30</span> : <span class="hljs-number">5</span>)
                .frame(width: recordBegin ? <span class="hljs-number">60</span> : <span class="hljs-number">250</span>, height: <span class="hljs-number">60</span>)
                .foregroundColor(recordBegin ? .red : .green)
                .overlay(
                    <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;mic.fill&quot;</span>)
                        .font(.system(.title))
                        .foregroundColor(.white)
                        .scaleEffect(recording ? <span class="hljs-number">0.7</span> : <span class="hljs-number">1</span>)
                )

            <span class="hljs-type">RoundedRectangle</span>(cornerRadius: recordBegin ? <span class="hljs-number">35</span> : <span class="hljs-number">10</span>)
                .trim(from: <span class="hljs-number">0</span>, to: recordBegin ? <span class="hljs-number">0.0001</span> : <span class="hljs-number">1</span>)
                .stroke(lineWidth: <span class="hljs-number">5</span>)
                .frame(width: recordBegin ? <span class="hljs-number">70</span> : <span class="hljs-number">260</span>, height: <span class="hljs-number">70</span>)
                .foregroundColor(.green)

        }
        .onTapGesture {
            withAnimation(<span class="hljs-type">Animation</span>.spring()) {
                <span class="hljs-keyword">self</span>.recordBegin.toggle()
            }

            withAnimation(<span class="hljs-type">Animation</span>.spring().repeatForever().delay(<span class="hljs-number">0.5</span>)) {
                <span class="hljs-keyword">self</span>.recording.toggle()
            }
        }
    }
}
</code></pre>
<p>这里有两个状态变数：<code>recordBegin</code> 与 <code>recording</code>，其是控制两个单独的动画。第一个变数控制按钮的变形，如前所述，我们使用圆角半径来实现这个变形。矩形的宽度原先是设定为“250 点”，当使用者点击矩形来触发变形时，这个框架的宽度会变为“60 点”。随着改变，圆角半径变成“30 点”，也就是宽度的一半。</p>
<p>这就是我们将矩形变形为圆形的方法，而且SwiftUI 会自动渲染此变形的动画。</p>
<p>另一方面，<code>recording</code> 状态变数处理了麦克风图片的缩放。当它为录音状态时，我们将缩放比例从“1”更改为“0.7”，藉由重复执行相同的动画，即可建立放大及缩小的动画。</p>
<p>请注意，以上的代码使用显式方法来对视图设定动画。这不是强制性的，依照自己的喜好，你也可以使用隐式动画方法来获得相同的结果。</p>
<h3 id="%E4%BA%86%E8%A7%A3%E8%BD%89%E5%A0%B4">了解转场</h3>
<p>到目前为止，我们已经讨论了对视图层次（view hierarchy ）中已存在的视图设定动画。我们建立动画来放大和缩小视图，或者对视图大小设定动画。</p>
<p>SwiftUI 让开发者不只是做出前述的动画，你可以定义如何从视图层次中插入或移除视图，而在 SwiftUI 中，这就是所谓的“转场”（ transition ）。框架预设是使用淡入（ fade in ）与淡出（ fade out ）转场。不过它内建了几个现成的转场效果，如滑动（ slide ）、移动（ move）、不透明度（opacity ）等。当然，你可以开发自己的转场效果，也可以简单的混合搭配各种类型的转场，以建立所需的转场效果。</p>
<figure id="fig9.10"><img src="images/animation/swiftui-animation-10.gif" alt="图 9.10.　使用 SwiftUI 建立的转场范例"><figcaption>图 9.10.　使用 SwiftUI 建立的转场范例</figcaption></figure>
<h4 id="%E5%BB%BA%E7%AB%8B%E7%B0%A1%E5%96%AE%E7%9A%84%E8%BD%89%E5%A0%B4">建立简单的转场</h4>
<p>我们来看一个简单的范例，以更加了解转场的含义以及动画如何运作。建立一个名为 <code>SwiftUITransition</code> 的新专案，并更新 <code>ContentView</code> 如下： </p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">ContentView</span>: <span class="hljs-title">View</span> </span>{

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">VStack</span> {
            <span class="hljs-type">RoundedRectangle</span>(cornerRadius: <span class="hljs-number">10</span>)
                .frame(width: <span class="hljs-number">300</span>, height: <span class="hljs-number">300</span>)
                .foregroundColor(.green)
                .overlay(
                    <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Show details&quot;</span>)
                        .font(.system(.largeTitle, design: .rounded))
                        .bold()
                        .foregroundColor(.white)

            )

            <span class="hljs-type">RoundedRectangle</span>(cornerRadius: <span class="hljs-number">10</span>)
                .frame(width: <span class="hljs-number">300</span>, height: <span class="hljs-number">300</span>)
                .foregroundColor(.purple)
                .overlay(
                    <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Well, here is the details&quot;</span>)
                        .font(.system(.largeTitle, design: .rounded))
                        .bold()
                        .foregroundColor(.white)
                )
        }
    }
}
</code></pre>
<p>在上列的代码中，我们使用 <code>VStack</code> 垂直布局两个矩形。而我要做的是让这个堆叠可以点击。首先，要隐藏紫色矩形，只有当使用者点击绿色矩形（也就是Show details ）时才会显示。</p>
<figure id="fig9.11"><img src="images/animation/swiftui-animation-11.png" alt="图 9.11.　垂直布局两个矩形"><figcaption>图 9.11.　垂直布局两个矩形</figcaption></figure>
<p>为此，我们需要宣告一个状态变数来决定是否显示紫色矩形。将下列这行代码插入 <code>ContentView</code> 中： </p>
<pre><code class="lang-swift">@<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> show = <span class="hljs-built_in">false</span>
</code></pre>
<p>接下来，我们将紫色矩形包裹在 <code>if</code> 叙述中，如下所示：</p>
<pre><code class="lang-swift"><span class="hljs-keyword">if</span> show {
    <span class="hljs-type">RoundedRectangle</span>(cornerRadius: <span class="hljs-number">10</span>)
        .frame(width: <span class="hljs-number">300</span>, height: <span class="hljs-number">300</span>)
        .foregroundColor(.purple)
        .overlay(
            <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Well, here is the details&quot;</span>)
                .font(.system(.largeTitle, design: .rounded))
                .bold()
                .foregroundColor(.white)
        )
}
</code></pre>
<p>对于 <code>VStack</code>，我们加入 <code>onTapGesture</code> 函数来侦测点击，并为状态变化建立动画。请注意，该转场效果与动画要有关联，否则它无法自行运作。</p>
<pre><code class="lang-swift">.onTapGesture {
    withAnimation(<span class="hljs-type">Animation</span>.spring()) {
        <span class="hljs-keyword">self</span>.show.toggle()
    }
}
</code></pre>
<p>当使用者点击堆叠时，我们切换为 <code>show</code> 变数来显示紫色矩形。如果你在模拟器或预览画布中执行这个 App，则应该只会看到绿色矩形，如图 9.12 所示。点击它会显示紫色矩形，而你应可看到一个平滑的淡入与淡出的转场效果。</p>
<figure id="fig9.12"><img src="images/animation/swiftui-animation-12.png" alt="图 9.12.　预设的转场效果"><figcaption>图 9.12.　预设的转场效果</figcaption></figure>
<p>如前所述，如果你没有指定想使用的转场效果，SwiftUI 将渲染淡入淡出转场。要使用其他的转场效果，则在紫色矩形中加入 <code>transition</code> 修饰器，如下所示： </p>
<pre><code class="lang-swift"><span class="hljs-keyword">if</span> show {
    <span class="hljs-type">RoundedRectangle</span>(cornerRadius: <span class="hljs-number">10</span>)
        .frame(width: <span class="hljs-number">300</span>, height: <span class="hljs-number">300</span>)
        .foregroundColor(.purple)
        .overlay(
            <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Well, here is the details&quot;</span>)
                .font(.system(.largeTitle, design: .rounded))
                .bold()
                .foregroundColor(.white)
        )
        .transition(.scale(scale: <span class="hljs-number">0</span>, anchor: .bottom))
}
</code></pre>
<p>这个 <code>transition</code> 修饰器会带入一个 <code>AnyTransition</code> 型别的参数。这里我们使用scale 转场， 锚点（anchor ）设定为 <code>.bottom</code>，这就是你修改转场效果所需要做的事情。在模拟器中执行该 App，并看一下结果为何，当 App 显示紫色矩形时，你应该会看到一个弹出动画。我建议使用内建的模拟器来测试动画，而不采用 App 预览的方式，因为预览画布可能无法正确的渲染转场动作。</p>
<figure id="fig9.13"><img src="images/animation/swiftui-animation-13.png" alt="图 9.13.　缩放转场效果"><figcaption>图 9.13.　缩放转场效果</figcaption></figure>
<p>除了 .scale 之外，SwiftUI 框架还有多个内建的转场效果，包括 <code>.opaque</code>、<code>.offset</code>、<code>.move</code> 与 <code>.slide</code>。试着以位移转场（offset transition）取代缩放转场（scale transition），如下所示： </p>
<pre><code class="lang-swift">.transition(.offset(x: -<span class="hljs-number">600</span>, y: <span class="hljs-number">0</span>))
</code></pre>
<p>如此，当紫色矩形插入 <code>VStack</code> 时，它会从左侧滑入。</p>
<h4 id="%E6%B7%B7%E5%90%88%E5%BC%8F%E8%BD%89%E5%A0%B4">混合式转场</h4>
<p>你可以调用 <code>combined(with:)</code> 方法来将两个或者更多个转场效果结合在一起，以建立更流畅的转场效果。举例而言，如果要结合位移与缩放动画，则可以撰写代码如下： </p>
<pre><code class="lang-swift">.transition(<span class="hljs-type">AnyTransition</span>.offset(x: -<span class="hljs-number">600</span>, y: <span class="hljs-number">0</span>).combined(with: .scale))
</code></pre>
<p>如果需要混合三个转场效果的话，则可以参考以下这行的范例代码： </p>
<pre><code class="lang-swift">.transition(<span class="hljs-type">AnyTransition</span>.offset(x: -<span class="hljs-number">600</span>, y: <span class="hljs-number">0</span>).combined(with: .scale).combined(with: .opacity))
</code></pre>
<p>在某些情况下，如果你需要定义一个可以重复利用的动画，你可以在 <code>AnyTransition</code> 定义一个扩展（extension ），如下所示： </p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">AnyTransition</span> </span>{
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> offsetScaleOpacity: <span class="hljs-type">AnyTransition</span> {
        <span class="hljs-type">AnyTransition</span>.offset(x: -<span class="hljs-number">600</span>, y: <span class="hljs-number">0</span>).combined(with: .scale).combined(with: .opacity)
    }
}
</code></pre>
<p>接着，你可以在 <code>transition</code> 修饰器中使用 <code>offsetScaleOpacity</code> 动画： </p>
<pre><code class="lang-swift">.transition(.offsetScaleOpacity)
</code></pre>
<p>执行这个App，并再次测试转场效果，看起来很棒吧？</p>
<figure id="fig9.14"><img src="images/animation/swiftui-animation-14.png" alt="图 9.14.　结合缩放、位移与不透明度的转场效果"><figcaption>图 9.14.　结合缩放、位移与不透明度的转场效果</figcaption></figure>
<h4 id="%E4%B8%8D%E5%B0%8D%E7%A8%B1%E8%BD%89%E5%A0%B4">不对称转场</h4>
<p>我们刚才讨论的转场皆是对称性的，也就是视图的插入与移除是使用相同的转场效果。举例而言，如果将缩放转场运用于视图，则 SwiftUI 在它插入视图层次时会放大视图，而移除它时，该框架会将其缩回原来大小。</p>
<p>那么，若你想在插入视图时使用缩放转场以及移除视图时使用位移转场呢？这在 SwiftUI 中，即所谓的“不对称转场”（ Assymetric Transitions ）。要使用这种转场效果非常简单，你只需要调用 <code>.assymetric</code> 方法，来指定插入（ insertion ）及移除（removal ）的转场即可。下列是范例代码： </p>
<pre><code class="lang-swift">.transition(.asymmetric(insertion: .scale(scale: <span class="hljs-number">0</span>, anchor: .bottom), removal: .offset(x: -<span class="hljs-number">600</span>, y: <span class="hljs-number">0</span>)))
</code></pre>
<p>另外，如果你需要重新使用这个转场，则可以在 <code>AnyTransition</code>定义一个扩展，如下所示： </p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">extension</span> <span class="hljs-title">AnyTransition</span> </span>{
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> scaleAndOffset: <span class="hljs-type">AnyTransition</span> {
        <span class="hljs-type">AnyTransition</span>.asymmetric(
            insertion: .scale(scale: <span class="hljs-number">0</span>, anchor: .bottom),
            removal: .offset(x: -<span class="hljs-number">600</span>, y: <span class="hljs-number">00</span>)
        )
    }
}
</code></pre>
<p>更改代码后，请使用内建模拟器来执行这个 App。当紫色矩形出现于荧幕上时，你应该会看到缩放转场，而当你点击矩形时，紫色矩形会滑出荧幕画面。</p>
<figure id="fig9.15"><img src="images/animation/swiftui-animation-15.png" alt="图 9.15.　不对称转场范例"><figcaption>图 9.15.　不对称转场范例</figcaption></figure>
<h3 id="%E4%BD%9C%E6%A5%AD-1-%E4%BD%BF%E7%94%A8%E5%8B%95%E7%95%AB%E8%88%87%E8%BD%89%E5%A0%B4%E5%BB%BA%E7%AB%8B%E7%B2%BE%E7%BE%8E%E6%8C%89%E9%88%95">作业 #1: 使用动画与转场建立精美按钮</h3>
<p>现在，你应该具备了转场与动画的概念，我们来挑战建立一个精美的按钮，以显示目前操作状态。请输入下列网址：<a href="https://www.appcoda.com/wp-content/uploads/2019/10/swiftui-animation-16.gif" target="_blank">https://www.appcoda.com/wp-content/uploads/2019/10/swiftui-animation-16.gif</a>，来看一下效果。</p>
<figure id="fig9.16"><img src="images/animation/swiftui-animation-16.gif" alt="图 9.16.　精美按钮"><figcaption>图 9.16.　精美按钮</figcaption></figure>
<p>这个按钮有三种状态： </p>
<ul>
<li><strong>原始状态</strong>：以绿色显示“Submit”按钮。</li>
<li><strong>处理状态</strong>：显示一个旋转的圆环，并更新其标签为“Processing”。</li>
<li><strong>完成状态</strong>：以红色显示“Done”按钮。</li>
</ul>
<p>这是一个非常具挑战性的专案，它将测试你对 SwiftUI 动画与转场的了解。你将需要结合到目前为止所学的知识来制定解决方案。</p>
<p>如图 9.16 所示的范例按钮，这个处理状态大约是 4 秒处理状态约需要 4 秒，你不需要执行实际操作。作为提示，我使用下列的代码来模拟该操作。</p>
<pre><code class="lang-swift">private <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">startProcessing</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">self</span>.loading = <span class="hljs-built_in">true</span>

    <span class="hljs-comment">// 使用DispatchQueue.main.asyncAfter 来模拟操作</span>
    <span class="hljs-comment">// 在真实世界的专案中，你将在这里执行一个任务</span>
    <span class="hljs-comment">// 当任务完成之后，你将完成状态设定为true</span>
    <span class="hljs-type">DispatchQueue</span>.main.asyncAfter(deadline: .now() + <span class="hljs-number">4</span>) {
        <span class="hljs-keyword">self</span>.completed = <span class="hljs-built_in">true</span>
    }
}
</code></pre>
<h3 id="%E4%BD%9C%E6%A5%AD-2-%E8%A6%96%E5%9C%96%E8%BD%89%E5%A0%B4%E5%8B%95%E7%95%AB">作业 #2: 视图转场动画</h3>
<p>你已经学会了如何实作视图转场，试着结合在第 5 章中建立的卡片视图专案，并建立如下所示的视图转场。当使用者点击卡片时，目前的视图将缩小并淡出，下一个视图将以放大动画显示在前面。</p>
<figure id="fig9.17"><img src="images/animation/swiftui-animation-17.png" alt="图 9.17.　视图转场动画"><figcaption>图 9.17.　视图转场动画</figcaption></figure>
<p>如果你不懂上述的动画， 则可以输入网址： <a href="https://www.appcoda.com/wp-content/uploads/2019/10/swiftui-view-animation.gif" target="_blank">https://www.appcoda.com/wp-content/uploads/2019/10/swiftui-view-animation.gif</a>，来看一下动画效果。</p>
<h3 id="%E6%9C%AC%E7%AB%A0%E5%B0%8F%E7%B5%90">本章小结</h3>
<p>动画在行动 UI 设计中扮演着一个特殊的角色，精心设计的动画可改善使用者体验，并让 UI 的互动具有意义。两个视图之间流畅轻快的转场，将让使用者满意且印象深刻。在 App Store 上有超过 200 万支 App，要使你的 App 脱颖而出，并不容易，不过精心设计的 UI 与动画肯定会产生根本的差别。</p>
<p>话虽如此，但是对于有经验的开发者而言，撰写平滑动画动画也不是一件容易的事。幸运的是，SwiftUI 框架简化了 UI 动画与转场的开发，你只须告诉框架：视图在开始及结束时的状态为何，SwiftUI 会计算出其余的状态，为你渲染出一个流畅且漂亮的动画。</p>
<p>在本章中，我已介绍了基本的原理，不过如你所见，你已经建立了一些令人愉悦的动画与转场效果，最重要的是，只需要几行代码即能办到。</p>
<p>我期望你喜欢本章的内容，并发掘出有用的技巧。在本章所准备的范例档中，有完整的专案与作业解答可以下载： </p>
<ul>
<li><p>范例专案 (<a href="https://www.appcoda.com/resources/swiftui4/SwiftUIAnimation.zip" target="_blank">https://www.appcoda.com/resources/swiftui4/SwiftUIAnimation.zip</a>)</p>
</li>
<li><p>作业解答 #1 (<a href="https://www.appcoda.com/resources/swiftui4/SwiftUIAnimationExercise1.zip" target="_blank">https://www.appcoda.com/resources/swiftui4/SwiftUIAnimationExercise1.zip</a>)</p>
</li>
<li><p>作业解答 #2 (<a href="https://www.appcoda.com/resources/swiftui4/SwiftUICardAnimation.zip" target="_blank">https://www.appcoda.com/resources/swiftui4/SwiftUICardAnimation.zip</a>)</p>
</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./swiftui-path-shape.html" class="navigation navigation-prev " aria-label="Previous page: 实作路径(Path)与形状(Shape)来画线与圆饼图"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./swiftui-list.html" class="navigation navigation-next " aria-label="Next page: 动态列表、 ForEach 与 Identifiable 的使用方法"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":"white","family":"serif","size":3},"image-captions":{"caption":"_CAPTION_","variable_name":"_pictures"}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
