<!DOCTYPE HTML>
<html lang="zh-tw" >
    
    <head>
        
        <meta charset=utf-8"UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>滑动删除、内容选单与动作列表 | 精通 SwiftUI - iOS 16 版</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.1">
        <meta name="author" content="Simon Ng">
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="./swiftui-gestures.html" />
    
    
    <link rel="prev" href="./swiftui-form-registration.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-image-captions/image-captions.css">
        
    
    
        <link rel="stylesheet" href="././styles/website.css">
    

        
    <div class="book" data-level="16" data-basepath="." data-revision="Thu Dec 01 2022 17:36:55 GMT+0800 (HKT)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="输入并搜寻" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
            
            <li>
                <a href="https://www.appcoda.com.tw" target="blank" class="custom-link">Made by AppCoda</a>
            </li>
        
            
            <li>
                <a href="https://www.appcoda.com.tw/contact" target="blank" class="custom-link">Contact us / Support</a>
            </li>
        
            
            <li>
                <a href="http://twitter.com/share?text=Mastering%20SwiftUI%20via%20@appcodamobile&amp;url=https://www.appcoda.com.tw/swiftui/&amp;hashtags=swiftlang" target="blank" class="custom-link">Tweet this book</a>
            </li>
        
        

        
        <li class="divider"></li>
        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                        序言
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="swiftui-basics.html">
            
                
                    <a href="./swiftui-basics.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        SwiftUI 介绍
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="swiftui-text.html">
            
                
                    <a href="./swiftui-text.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        SwiftUI 入门 - 文字的处理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="swiftui-images.html">
            
                
                    <a href="./swiftui-images.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        图片的处理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="swiftui-stacks.html">
            
                
                    <a href="./swiftui-stacks.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        以堆叠布局使用者介面
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="swiftui-scrollview.html">
            
                
                    <a href="./swiftui-scrollview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        ScrollView 与 Carousel UI 的建立
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="swiftui-buttons.html">
            
                
                    <a href="./swiftui-buttons.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        SwiftUI 按钮与渐层
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="swiftui-state.html">
            
                
                    <a href="./swiftui-state.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        状态(State)与绑定(Binding)
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="swiftui-path-shape.html">
            
                
                    <a href="./swiftui-path-shape.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        实现路径(Path)与形状(Shape)来画线与圆饼图
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="swiftui-animation.html">
            
                
                    <a href="./swiftui-animation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        基础动画与转场
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="swiftui-list.html">
            
                
                    <a href="./swiftui-list.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        动态列表、 ForEach 与 Identifiable 的使用方法
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="swiftui-navigation.html">
            
                
                    <a href="./swiftui-navigation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        导航UI与导航列客制化运用
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="swiftui-modal.html">
            
                
                    <a href="./swiftui-modal.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        强制回应视图、浮动按钮与提示的实现
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="swiftui-form.html">
            
                
                    <a href="./swiftui-form.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        以选取器(Picker)、开关(Toggle)与步进器(Stepper)来建立一个表单
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="swiftui-form-data.html">
            
                
                    <a href="./swiftui-form-data.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        使用 Combine 与 Environment 物件进行数据分享
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="swiftui-form-registration.html">
            
                
                    <a href="./swiftui-form-registration.html">
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        以 Combine 与 视图模型建立一个注册表单
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="16" data-path="swiftui-actionsheet-context.html">
            
                
                    <a href="./swiftui-actionsheet-context.html">
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        滑动删除、内容选单与动作列表
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="swiftui-gestures.html">
            
                
                    <a href="./swiftui-gestures.html">
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        认识手势（Gestures）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="swiftui-bottom-sheet.html">
            
                
                    <a href="./swiftui-bottom-sheet.html">
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        以SwiftUI 手势与 GeometryReader 建立一个底部展开式页面
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="swiftui-trip-tinder.html">
            
                
                    <a href="./swiftui-trip-tinder.html">
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        使用手势与动画建立 Tinder 风格的 UI
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="swiftui-advanced-animations.html">
            
                
                    <a href="./swiftui-advanced-animations.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        建立像 Apple Wallet App 的动画和转场效果
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="swiftui-json.html">
            
                
                    <a href="./swiftui-json.html">
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        JSON、滑杆的运用与数据过滤
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="swiftui-core-data.html">
            
                
                    <a href="./swiftui-core-data.html">
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        如何使用 Core Data 建立 ToDo App
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="swiftui-uikit.html">
            
                
                    <a href="./swiftui-uikit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        利用 UIViewRepresentable 整合UIKit 组件
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="24" data-path="swiftui-searchbar.html">
            
                
                    <a href="./swiftui-searchbar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        建立搜寻栏视图并使用自订绑定（Custom Binding）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="swiftui-real-world-app.html">
            
                
                    <a href="./swiftui-real-world-app.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        把所学应用出来！构建个人理财App
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="26" data-path="swiftui-appstoreanimation.html">
            
                
                    <a href="./swiftui-appstoreanimation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                        创建类似App Store使用的动画视图转换
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="27" data-path="swiftui-carousel.html">
            
                
                    <a href="./swiftui-carousel.html">
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                        如何建立图像轮播（Image Carousel）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="28" data-path="swiftui-expandable-list.html">
            
                
                    <a href="./swiftui-expandable-list.html">
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                        如何建立展开式列表视图和大纲视图
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="29" data-path="swiftui-gridlayout.html">
            
                
                    <a href="./swiftui-gridlayout.html">
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                        使用 LazyVGrid 和 LazyHGrid 构建集合视图
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="30" data-path="swiftui-progress-ring.html">
            
                
                    <a href="./swiftui-progress-ring.html">
                        <i class="fa fa-check"></i>
                        
                            <b>30.</b>
                        
                        使用 Shape 和 Animatable 开发带动画的环形进度条
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="31" data-path="swiftui-library.html">
            
                
                    <a href="./swiftui-library.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.</b>
                        
                        如何使用 AnimatableModifier 和 LibraryContentProvider
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="32" data-path="swiftui-texteditor.html">
            
                
                    <a href="./swiftui-texteditor.html">
                        <i class="fa fa-check"></i>
                        
                            <b>32.</b>
                        
                        使用 TextEditor 支持多行文字输入
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="33" data-path="swiftui-matchedgeometry.html">
            
                
                    <a href="./swiftui-matchedgeometry.html">
                        <i class="fa fa-check"></i>
                        
                            <b>33.</b>
                        
                        使用 matchedGeometryEffect为 App 建立绚丽的视图动画
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="34" data-path="swiftui-grid-animation.html">
            
                
                    <a href="./swiftui-grid-animation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>34.</b>
                        
                        ScrollViewReader 和网格动画
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="35" data-path="swiftui-tabview.html">
            
                
                    <a href="./swiftui-tabview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>35.</b>
                        
                        标签视图的运用与自订标签列
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="36" data-path="swiftui-asyncimage.html">
            
                
                    <a href="./swiftui-asyncimage.html">
                        <i class="fa fa-check"></i>
                        
                            <b>36.</b>
                        
                        利用 AsyncImage 非同步加载和显示图像
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="37" data-path="swiftui-searchable.html">
            
                
                    <a href="./swiftui-searchable.html">
                        <i class="fa fa-check"></i>
                        
                            <b>37.</b>
                        
                        利用 Searchable 建立搜寻栏
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="38" data-path="swiftui-charts.html">
            
                
                    <a href="./swiftui-charts.html">
                        <i class="fa fa-check"></i>
                        
                            <b>38.</b>
                        
                        利用 Charts 框架建立图表
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="39" data-path="swiftui-live-text.html">
            
                
                    <a href="./swiftui-live-text.html">
                        <i class="fa fa-check"></i>
                        
                            <b>39.</b>
                        
                        利用 Live Text API 从图片中撷取文本
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="40" data-path="swiftui-sharelink.html">
            
                
                    <a href="./swiftui-sharelink.html">
                        <i class="fa fa-check"></i>
                        
                            <b>40.</b>
                        
                        通过 ShareLink 来分享文本和图像等数据
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="41" data-path="swiftui-imagerenderer.html">
            
                
                    <a href="./swiftui-imagerenderer.html">
                        <i class="fa fa-check"></i>
                        
                            <b>41.</b>
                        
                        利用 ImageRenderer API 轻松把 SwiftUI 视图转换为图像
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="42" data-path="swiftui-pdf-doc.html">
            
                
                    <a href="./swiftui-pdf-doc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>42.</b>
                        
                        如何把 SwiftUI 视图转换为 PDF 文件
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="43" data-path="swiftui-gauge.html">
            
                
                    <a href="./swiftui-gauge.html">
                        <i class="fa fa-check"></i>
                        
                            <b>43.</b>
                        
                        使用 Gauge 视图显示进度并创建速度计
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="44" data-path="swiftui-grid.html">
            
                
                    <a href="./swiftui-grid.html">
                        <i class="fa fa-check"></i>
                        
                            <b>44.</b>
                        
                        使用Grid API 创建网格布局
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="45" data-path="swiftui-anylayout.html">
            
                
                    <a href="./swiftui-anylayout.html">
                        <i class="fa fa-check"></i>
                        
                            <b>45.</b>
                        
                        利用 AnyLayout 切换 UI 布局
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="46" data-path="swiftui-navigationstack.html">
            
                
                    <a href="./swiftui-navigationstack.html">
                        <i class="fa fa-check"></i>
                        
                            <b>46.</b>
                        
                        使用新的 NavigationStack 视图构建数据导向的导航
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                本书使用 GitBook 释出
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="目录"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="搜寻"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="字型设定"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">衬线体</button>
        <button type="button" data-font="1" class="button">无衬线体</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">白色</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">棕褐色</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">夜间</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="分享"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    分享到 Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    分享到 Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    分享到 Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    分享到 Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    分享到 Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >精通 SwiftUI - iOS 16 版</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="%E7%AC%AC-16-%E7%AB%A0-br-%E4%BD%BF%E7%94%A8%E6%BB%91%E5%8B%95%E5%88%AA%E9%99%A4%E3%80%81%E5%85%A7%E5%AE%B9%E9%81%B8%E5%96%AE%E8%88%87%E5%8B%95%E4%BD%9C%E8%A1%A8">第 16 章<br>使用滑动删除、内容选单与动作表</h1>
<p>在前面的章节中，你已经学会如何使用清单来显示数据列。而在本章中，我们将会更深入一点，了解如何让使用者和清单视图进行互动，包括： </p>
<ul>
<li>使用滑动删除一列。</li>
<li>点击一列来启用动作表（action sheet）。</li>
<li>长按一列来弹出内容选单（context menu）。</li>
</ul>
<figure id="fig16.1"><img src="images/actionsheet/swiftui-actionsheet-1.jpg" alt="图 16.1.　滑动删除（左图）、内容选单与动作表（右图)"><figcaption>图 16.1.　滑动删除（左图）、内容选单与动作表（右图)</figcaption></figure>
<p>参考图 16.1，我相信你应该非常熟悉“滑动删除”与“动作表”，这两个 UI 元素在 iOS 中已经存在多年，而内容选单则是在 iOS 13 新导入，尽管它看起来类似 3D Touch 的预览（peek ）与弹出（pop ）。对于使用内容选单实现的任何视图（例如：按钮），每当使用者在视图上做压力触控（force touch ）时，iOS 会弹出一个弹出选单。对于开发者而言，配置选单中显示的动作项目是你的责任。</p>
<p>虽然本章的重点是“与清单的互动”，但是我所介绍的技巧也可以应用于其他的UI 控制组件（例如：按钮）。</p>
<h3 id="%E6%BA%96%E5%82%99%E8%B5%B7%E5%A7%8B%E5%B0%88%E6%A1%88">准备起始项目</h3>
<p>我们开始建立这个项目，而我们将以之前建立的清单 App 为基础，来建立一个互动式清单。你可以至</p>
<p><a href="https://www.appcoda.com/resources/swiftui4/SwiftUIActionSheetStarter.zip" target="_blank">https://www.appcoda.com/resources/swiftui4/SwiftUIActionSheetStarter.zip</a> 来下载项目，下载后开启项目，并检查预览，它应该会显示一个包含文字与图片的简单清单，如图 16.2 所示。稍后，我们将在这个示例 App 中加入滑动删除功能、一个动作表与一个内容选单。</p>
<figure id="fig16.2"><img src="images/actionsheet/swiftui-actionsheet-2.png" alt="图 16.2.　起始项目会显示一个简单的清单视图"><figcaption>图 16.2.　起始项目会显示一个简单的清单视图</figcaption></figure>
<p>如果你的眼睛够敏锐的话，你可能会发现起始项目使用 <code>ForEach</code> 来实现该清单。为什么我将它变更回 <code>ForEach</code>，而不是传送数据集合至 <code>List</code> 呢？主要原因是我将介绍的 <code>onDelete</code>处理器只能使用 <code>ForEach</code>。</p>
<h3 id="%E5%AF%A6%E4%BD%9C%E6%BB%91%E5%8B%95%E5%88%AA%E9%99%A4">实现滑动删除</h3>
<p>假设你已经准备好起始项目了，我们开始实现“滑动删除”（swipe to delete ）功能，我已经简要提过 <code>onDelete</code> 处理器。要对清单中的所有列启用“滑动删除”功能，你只需要将这个处理器加到所有列的数据即可。因此，修改 <code>List</code> 如下： </p>
<pre><code class="lang-swift"><span class="hljs-type">List</span> {
    <span class="hljs-type">ForEach</span>(restaurants) { restaurant <span class="hljs-keyword">in</span>
        <span class="hljs-type">BasicImageRow</span>(restaurant: restaurant)
    }
    .onDelete { (indexSet) <span class="hljs-keyword">in</span>
        <span class="hljs-keyword">self</span>.restaurants.remove(atOffsets: indexSet)
    }
}
.listStyle(.plain)
</code></pre>
<p>在 <code>onDelete</code> 的闭包中，它将传送一个 <code>indexSet</code>，其储存要删除的列的索引，然后我们使用 <code>indexSet</code> 调用<code>remove</code> 方法，以删除在 <code>restaurants</code> 数组中的特定项目。</p>
<p>在“滑动删除”功能可以运作之前，还一件事要做。每当使用者从清单中删除一列时， UI 应该相应修改。正如前面章节所讨论的，SwiftUI 有一个非常强大的功能来管理应用程序的状态。在我们的代码中，当使用者选择删除一笔纪录时，<code>restaurants</code> 数组的值将更考，我们必须要求 SwiftUI 监控属性，并在属性值修改时修改UI。</p>
<p>为此，插入 <code>@State</code> 关键字至 <code>restaurants</code> 变量： </p>
<pre><code class="lang-swift">@<span class="hljs-type">State</span> <span class="hljs-keyword">var</span> restaurants = [ ... ]
</code></pre>
<p>当你修改后，你应该能够在预览试试这个删除功能。向左滑动任一列来显示出“删除”（Delete ）按钮，如图 16.3 所示。点击它，该列将从清单中删除。顺带一提，你是否注意到删除该列时的精美动画呢？你不需要撰写任何额外的代码，这个动画是由 SwiftUI 自动产生。很酷，对吧？</p>
<figure id="fig16.3"><img src="images/actionsheet/swiftui-actionsheet-3.png" alt="图 16.3.　从清单中删除项目"><figcaption>图 16.3.　从清单中删除项目</figcaption></figure>
<p>如果你之前使用过 UIKit 编写相同的功能，我相信你会对 SwiftUI 感到惊讶。只需要几行代码与一个关键字，你便已实现了“滑动删除”功能。</p>
<h3 id="%E5%BB%BA%E7%AB%8B%E5%85%A7%E5%AE%B9%E9%81%B8%E5%96%AE">建立内容选单</h3>
<p>接下来，我们来讨论内容选单（Context Menu）。如前所述，内容选单类似于 3D Touch 的预览（peek ）及弹出（pop ），有个明显的差别在于，这个功能适用于所有运行 iOS 13 与之后版本的装置，即使该装置不支持 3D Touch 也可以。要弹出内容选单，人们需要使用长按的手势，而若是装置使用 3D Touch，则使用压力触控。</p>
<p>SwiftUI 使得内容选单的实现变得非常简单，你只需要将contextMenu 容器加到视图， 并设定它的选单项目即可。</p>
<p>在我们的示例 App 中，我们想在人们长按任何一列时触发内容选单。而在选单中，它提供了“删除”（Delete ）与“最爱”（Favorite ）等两个动作按钮，供使用者选择。当选择后，“删除”（Delete ）按钮将从清单中删除该列，“最爱”（Favorite ）按钮将以星号标记所选的列。</p>
<p>要在内容选单中显示这两个项目，我们可以将 <code>contextMenu</code> 加到清单中的每一列，如下所示： </p>
<pre><code class="lang-swift"><span class="hljs-type">List</span> {
    <span class="hljs-type">ForEach</span>(restaurants) { restaurant <span class="hljs-keyword">in</span>
        <span class="hljs-type">BasicImageRow</span>(restaurant: restaurant)
            .contextMenu {

                <span class="hljs-type">Button</span>(action: {
                    <span class="hljs-comment">// 删除所选的餐厅</span>
                }) {
                    <span class="hljs-type">HStack</span> {
                        <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Delete&quot;</span>)
                        <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;trash&quot;</span>)
                    }
                }

                <span class="hljs-type">Button</span>(action: {
                    <span class="hljs-comment">// 将所选的餐厅标记为最爱</span>
                }) {
                    <span class="hljs-type">HStack</span> {
                        <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Favorite&quot;</span>)
                        <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;star&quot;</span>)
                    }
                }
            }
    }
    .onDelete { (indexSet) <span class="hljs-keyword">in</span>
        <span class="hljs-keyword">self</span>.restaurants.remove(atOffsets: indexSet)
    }
}
.listStyle(.plain)
</code></pre>
<p>现在，我们还没有实现任何按钮动作。不过，若你试用 App，则当你长按其中一列时， 这个 App 会弹出内容选单，如图 16.4 所示。</p>
<figure id="fig16.4"><img src="images/actionsheet/swiftui-actionsheet-4.png" alt="图 16.4.　从清单中删除项目"><figcaption>图 16.4.　从清单中删除项目</figcaption></figure>
<p>现在，我们继续实现删除动作。与 <code>onDelete</code> 处理器不同的是，<code>contextMenu</code> 不会给我们所选餐厅的索引。要找出已选餐厅的索引，则需要做一些工作。在 <code>ContentView</code> 建立一个新函数： </p>
<pre><code class="lang-swift">private <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">delete</span><span class="hljs-params">(item restaurant: Restaurant)</span> </span>{
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> index = <span class="hljs-keyword">self</span>.restaurants.firstIndex(<span class="hljs-keyword">where</span>: { $<span class="hljs-number">0</span>.id == restaurant.id }) {
        <span class="hljs-keyword">self</span>.restaurants.remove(at: index)
    }
}
</code></pre>
<p>这个 <code>delete</code> 函数接受一个 =restaurant 物件，并在 <code>restaurants</code> 数组中搜寻它的索引。要找出索引，我们调用<code>firstIndex</code> 函数，并指定搜寻条件，这个函数会逐一运行数组，并将给定的餐厅 id 与数组中的 id 进行比对，如果有匹配的话，<code>firstIndex</code> 函式会回传给定餐厅的索引。当我们有了索引后，我们就可以通过调用 <code>remove(at:)</code> 从 <code>restaurants</code> 数组中删除餐厅。</p>
<p>接下来，在“// 删除所选的餐厅”下面插入下列的代码： </p>
<pre><code class="lang-swift"><span class="hljs-keyword">self</span>.delete(item: restaurant)
</code></pre>
<p>当使用者选择“删除”（Delete ）按钮时，我们只调用delete 函式。现在，你已经可以测试App 了。在画布中点选“播放”（Play ）按钮，来运行该App，长按其中一列来弹出内容选单，接着选择“删除”（Delete ），你应会看到所选的餐厅从清单中删除了。</p>
<p>我们继续“最爱”（Favorite ）按钮的实现。当这个按钮被选中时， App 将在所选的餐厅中放置一颗星。要实现这个功能，我们必须先修改 Restaurant 结构，并加入一个名为“isFavorite”的新属性，如下所示： </p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Restaurant</span>: <span class="hljs-title">Identifiable</span> </span>{
    <span class="hljs-keyword">var</span> id = <span class="hljs-type">UUID</span>()
    <span class="hljs-keyword">var</span> name: <span class="hljs-type">String</span>
    <span class="hljs-keyword">var</span> image: <span class="hljs-type">String</span>
    <span class="hljs-keyword">var</span> isFavorite: <span class="hljs-type">Bool</span> = <span class="hljs-built_in">false</span>
}
</code></pre>
<p>这个 <code>isFavorite</code> 属性指示餐厅是否标记为最爱，默认是设定为 <code>false</code>。</p>
<p>与“删除”功能类似，我们将会在 <code>ContentView</code>中建立一个单独的函数，来设定最爱的餐厅。插入下列代码来建立新函数： </p>
<pre><code class="lang-swift">private <span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">setFavorite</span><span class="hljs-params">(item restaurant: Restaurant)</span> </span>{
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> index = <span class="hljs-keyword">self</span>.restaurants.firstIndex(<span class="hljs-keyword">where</span>: { $<span class="hljs-number">0</span>.id == restaurant.id }) {
        <span class="hljs-keyword">self</span>.restaurants[index].isFavorite.toggle()
    }
}
</code></pre>
<p>这段代码与 <code>delete</code> 函式的代码很相似。我们首先找出给定餐厅的索引，当我们有了索引后，我们变更它的<code>isFavorite</code> 属性值。这里，我们调用 <code>toggle</code> 函数来切换这个值，例如：若 <code>isFavorite</code> 的原始值设定为<code>false</code>，则在调用 <code>toggle()</code> 后将变为 <code>true</code>。</p>
<p>接下来，我们必须处理列的 UI。当餐厅的 isFavorite 属性设定为 <code>true</code>时，列应该显示一个星号。修改<code>BasicImageRow</code> 结构如下： </p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">BasicImageRow</span>: <span class="hljs-title">View</span> </span>{
    <span class="hljs-keyword">var</span> restaurant: <span class="hljs-type">Restaurant</span>

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">HStack</span> {
            <span class="hljs-type">Image</span>(restaurant.image)
                .resizable()
                .frame(width: <span class="hljs-number">40</span>, height: <span class="hljs-number">40</span>)
                .cornerRadius(<span class="hljs-number">5</span>)
            <span class="hljs-type">Text</span>(restaurant.name)

            <span class="hljs-keyword">if</span> restaurant.isFavorite {
                <span class="hljs-type">Spacer</span>()

                <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;star.fill&quot;</span>)
                    .foregroundColor(.yellow)
            }
        }
    }
}
</code></pre>
<p>在上列的代码中，我们只在 <code>HStack</code> 中加入一个代码片段。若给定餐厅的 <code>isFavorite</code> 属性设定为 <code>true</code>，我们加入一个留白与一个系统图片至该列。</p>
<p>这就是我们如何实现“最爱”功能的方式。最后在“// 将所选的餐厅标记为最爱”下面插入下列这行代码来调用setFavorite 函数： </p>
<pre><code class="lang-swift"><span class="hljs-keyword">self</span>.setFavorite(item: restaurant)
</code></pre>
<p>现在该进行测试了。在画布中运行 App，长按其中一列（例如：Petite Oyster ），然后选择“最爱”（Favorite ），你应该会看到该列末尾出现一个星号，如图 16.5 所示。</p>
<figure id="fig16.5"><img src="images/actionsheet/swiftui-actionsheet-5.png" alt="图 16.5.　使用“最爱”的功能"><figcaption>图 16.5.　使用“最爱”的功能</figcaption></figure>
<h3 id="%E4%BD%BF%E7%94%A8%E5%8B%95%E4%BD%9C%E8%A1%A8">使用动作表</h3>
<p>以上为如何实现内容选单的方式。最后，我们来看如何在 SwiftUI 中建立一个动作表。我们将要建立的动作表提供了与内容选单一样的相同选项，如果你忘记动作表的外观，请再次参考图 16.1。</p>
<p>SwiftUI 框架有一个 <code>ActionSheet</code> 视图，可以让你建立动作表。基本上，你可以建立动作列表如下： </p>
<pre><code class="lang-swift"><span class="hljs-type">ActionSheet</span>(title: <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;What do you want to do&quot;</span>), message: <span class="hljs-built_in">nil</span>, buttons: [.<span class="hljs-keyword">default</span>(<span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Delete&quot;</span>))]
</code></pre>
<p>你使用标题及选项信息初始化一个动作表，<code>buttons</code> 参数接受一个按钮的数组。在示例代码中，它提供标题为“Delete”的默认按钮。</p>
<p>要启用动作表，可将 <code>actionSheet</code> 修饰器加到按钮或任何视图上来触发动作表。如果你研究 SwiftUI 的文件，则有两个弹出动作表的方式。</p>
<p>你可以使用 <code>isPresented</code> 参数来控制动作表的外观：  </p>
<pre><code class="lang-swift"><span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">actionSheet</span><span class="hljs-params">(isPresented: Binding&lt;Bool&gt;, content: <span class="hljs-params">()</span> -&gt; ActionSheet)</span> -&gt; <span class="hljs-title">some</span> <span class="hljs-title">View</span>
</span></code></pre>
<p>或者使用 Optional 绑定： </p>
<pre><code class="lang-swift"><span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">actionSheet</span><span class="hljs-generics">&lt;T&gt;</span><span class="hljs-params">(item: Binding&lt;T?&gt;, content: <span class="hljs-params">(T)</span> -&gt; ActionSheet)</span> -&gt; <span class="hljs-title">some</span> <span class="hljs-title">View</span> <span class="hljs-title">where</span> <span class="hljs-title">T</span> : <span class="hljs-title">Identifiable</span>
</span></code></pre>
<p>我们将使用这两个方法来显示动作表，你将可了解何时使用哪个方法。</p>
<p>于第一种方法，我们需要一个布林变量来表示动作的状态，以及一个 <code>Restaurant</code> 型别的变量来储存所选的餐厅。因此，在 <code>ContentView</code>中声明这两个变量： </p>
<pre><code class="lang-swift">@<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> showActionSheet = <span class="hljs-built_in">false</span>

@<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> selectedRestaurant: <span class="hljs-type">Restaurant</span>?
</code></pre>
<p>默认上，<code>showActionSheet</code> 变量设定为 <code>false</code>，这表示动作表不显示。当使用者选取一列时，我们会将这个变量切换为 <code>true</code>。顾名思义，<code>selectedRestaurant</code> 变量是设计用来存放所选的餐厅。这两个变量都有 <code>@State</code> 关键字，因为我们想要 SwiftUI 监控它们的变化，并相应修改UI。</p>
<p>接下来，加入 <code>onTapGesture</code> 与 <code>actionSheet</code> 修饰器至 <code>List</code> 视图，如下所示： </p>
<pre><code class="lang-swift"><span class="hljs-type">List</span> {
    <span class="hljs-type">ForEach</span>(restaurants) { restaurant <span class="hljs-keyword">in</span>
        <span class="hljs-type">BasicImageRow</span>(restaurant: restaurant)
            .contextMenu {

                ...
            }
            .onTapGesture {
                <span class="hljs-keyword">self</span>.showActionSheet.toggle()
                <span class="hljs-keyword">self</span>.selectedRestaurant = restaurant
            }
            .actionSheet(isPresented: <span class="hljs-keyword">self</span>.$showActionSheet) {

                <span class="hljs-type">ActionSheet</span>(title: <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;What do you want to do&quot;</span>), message: <span class="hljs-built_in">nil</span>, buttons: [

                    .<span class="hljs-keyword">default</span>(<span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Mark as Favorite&quot;</span>), action: {
                        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> selectedRestaurant = <span class="hljs-keyword">self</span>.selectedRestaurant {
                            <span class="hljs-keyword">self</span>.setFavorite(item: selectedRestaurant)
                        }
                    }),

                    .de<span class="hljs-class"><span class="hljs-keyword">struct</span><span class="hljs-title">ive</span>(<span class="hljs-title">Text</span>(&quot;<span class="hljs-title">Delete</span>&quot;), <span class="hljs-title">action</span>: </span>{
                        <span class="hljs-keyword">if</span> <span class="hljs-keyword">let</span> selectedRestaurant = <span class="hljs-keyword">self</span>.selectedRestaurant {
                            <span class="hljs-keyword">self</span>.delete(item: selectedRestaurant)
                        }
                    }),

                    .cancel()
                ])
            }
    }
    .onDelete { (indexSet) <span class="hljs-keyword">in</span>
        <span class="hljs-keyword">self</span>.restaurants.remove(atOffsets: indexSet)
    }
}
</code></pre>
<p>加到每列的 <code>onTapGesture</code>修饰器， 是用于侦测使用者的触控。当点击一列后， <code>onTapGesture</code> 中的代码区块将会运行。这里，我们切换 <code>showActionSheet</code> 变量，并设定 <code>selectedRestaurant</code>。</p>
<p>之前， 我已经解释过 <code>actionSheet</code> 修饰器的用法。在上列的代码中， 我们使用 <code>showActionSheet</code> 的绑定来传送 <code>isPresented</code> 参数，当 <code>showActionSheet</code> 设定为<code>true</code>时， 则会运行该代码区块。我们建立一个具有“标记为最爱”（Mark as Favorite ）、“删除”（Delete ）与“取消”（Cancel ）等三个按钮的<code>ActionSheet</code>，而动作表有三种按钮型别， 包括“默认”（default ）、“破坏性”（destructive）与“取消”（cancel ）。对于一般动作， 动作表通常使用默认按钮型别；破坏性按钮与默认按钮非常相似，但是字型颜色设定为“红色”，以表示为一些破坏性的动作（例如：删除）；“取消”按钮是一个特别的型别， 用于解除动作表。</p>
<p>对于“标记为最爱”（Mark as Favorite ）按钮，我们将其建立为默认按钮。在action 闭包中，我们调用 <code>setFavorite</code> 函式来加入星星。对于“删除”（Delete ）按钮，则建立为破坏性按钮，其与内容选单的“删除”（Delete ）按钮类似，我们调用 <code>delete</code> 函式来删除所选餐厅。</p>
<p>如果你已正确进行变更，则在清单视图中点击其中一列时应可弹出动作表。当选择“删除”（Delete）按钮，将会删除该列。若是你选择“标记为最爱”（Mark as Favorite）选项， 则将使用黄色星星标记该列，如图16.6 所示</p>
<figure id="fig16.6"><img src="images/actionsheet/swiftui-actionsheet-6.png" alt="图 16.6.　点击一列来显示动作表"><figcaption>图 16.6.　点击一列来显示动作表</figcaption></figure>
<p>一切都运作得很好，不过我承诺过带你了解使用 <code>actionSheet</code> 修饰器的第二种方法。我们已经介绍过第一种方法，它依据布林值（即 <code>showActionSheet</code> ）来指示是否应显示动作表。</p>
<p>第二种方法是通过一个 Optional Identifiable 绑定来触发动作表： </p>
<pre><code class="lang-swift"><span class="hljs-func"><span class="hljs-keyword">func</span> <span class="hljs-title">actionSheet</span><span class="hljs-generics">&lt;T&gt;</span><span class="hljs-params">(item: Binding&lt;T?&gt;, content: <span class="hljs-params">(T)</span> -&gt; ActionSheet)</span> -&gt; <span class="hljs-title">some</span> <span class="hljs-title">View</span> <span class="hljs-title">where</span> <span class="hljs-title">T</span> : <span class="hljs-title">Identifiable</span>
</span></code></pre>
<p>以白话来说，这表示当你传送的项目有值时，将会显示动作。对于我们的示例， <code>selectedRestaurant</code> 变量是一个 Optional，并遵守 <code>Identifiable</code> 协议。要使用第二种方法，你只需要将 <code>selectedRestaurant</code> 绑定传送至<code>actionSheet</code> 修饰器，如下所示： </p>
<pre><code class="lang-swift">.actionSheet(item: <span class="hljs-keyword">self</span>.$selectedRestaurant) { restaurant <span class="hljs-keyword">in</span>

    <span class="hljs-type">ActionSheet</span>(title: <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;What do you want to do&quot;</span>), message: <span class="hljs-built_in">nil</span>, buttons: [

        .<span class="hljs-keyword">default</span>(<span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Mark as Favorite&quot;</span>), action: {
            <span class="hljs-keyword">self</span>.setFavorite(item: restaurant)
        }),

        .de<span class="hljs-class"><span class="hljs-keyword">struct</span><span class="hljs-title">ive</span>(<span class="hljs-title">Text</span>(&quot;<span class="hljs-title">Delete</span>&quot;), <span class="hljs-title">action</span>: </span>{
            <span class="hljs-keyword">self</span>.delete(item: restaurant)
        }),

        .cancel()
    ])
}
</code></pre>
<p>如果 <code>selectedRestaurant</code> 有一个值，App 将会弹出动作表。从闭包的参数中，你可以取得所选的餐厅，并运行对应的操作。当你使用这个方法，则不再需要 <code>shownActionSheet</code>  布林变量，你可以从代码删除它： </p>
<pre><code class="lang-swift">@<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> showActionSheet = <span class="hljs-built_in">false</span>
</code></pre>
<p>另外，在 <code>tapGesture</code> 修饰器中，移除下列这行切换 <code>showActionSheet</code> 变量的代码：</p>
<pre><code class="lang-swift"><span class="hljs-keyword">self</span>.showActionSheet.toggle()
</code></pre>
<p>再次测试 App，动作表看起来还是一样，但你是以不同的方法来实现动作表。</p>
<div style="page-break-after: always;"></div>

<h3 id="%E4%BD%9C%E6%A5%AD">作业</h3>
<p>现在你应该对如何建立一个内容选单有了概念，我们来做一个作业，以测试你对内容的了解程度。你的任务是在内容选单中加入“打卡”（ Check-in ）项目。当使用者选择该选项时，App 将会在所选餐厅加入一个打卡符号，你可以参考图 16.7 的UI 示例。对于这个示例，我使用了名为 <code>checkmark.seal.fill</code> 的系统图片作为打卡符号，但你可以使用自己的图片。</p>
<p>在参考解答之前，请花点时间来练习这个作业，祝你玩得愉快 ！ </p>
<figure id="fig16.7"><img src="images/actionsheet/swiftui-actionsheet-7.png" alt="图 16.7.　加入“打卡”功能"><figcaption>图 16.7.　加入“打卡”功能</figcaption></figure>
<div style="page-break-after: always;"></div>

<p>在本章所准备的示例档中，有完整的项目与作业解答可以下载： </p>
<ul>
<li>示例项目与作业解答  (<a href="https://www.appcoda.com/resources/swiftui4/SwiftUIActionSheet.zip" target="_blank">https://www.appcoda.com/resources/swiftui4/SwiftUIActionSheet.zip</a>)</li>
</ul>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./swiftui-form-registration.html" class="navigation navigation-prev " aria-label="Previous page: 以 Combine 与 视图模型建立一个注册表单"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./swiftui-gestures.html" class="navigation navigation-next " aria-label="Next page: 认识手势（Gestures）"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":"white","family":"serif","size":3},"image-captions":{"caption":"_CAPTION_","variable_name":"_pictures"}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
