<!DOCTYPE HTML>
<html lang="zh-tw" >
    
    <head>
        
        <meta charset=utf-8"UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>建立搜寻栏视图并使用自订绑定（Custom Binding） | 精通 SwiftUI - iOS 16 版</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.1">
        <meta name="author" content="Simon Ng">
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="./swiftui-real-world-app.html" />
    
    
    <link rel="prev" href="./swiftui-uikit.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-image-captions/image-captions.css">
        
    
    
        <link rel="stylesheet" href="././styles/website.css">
    

        
    <div class="book" data-level="24" data-basepath="." data-revision="Thu Dec 01 2022 17:36:55 GMT+0800 (HKT)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="输入并搜寻" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
            
            <li>
                <a href="https://www.appcoda.com.tw" target="blank" class="custom-link">Made by AppCoda</a>
            </li>
        
            
            <li>
                <a href="https://www.appcoda.com.tw/contact" target="blank" class="custom-link">Contact us / Support</a>
            </li>
        
            
            <li>
                <a href="http://twitter.com/share?text=Mastering%20SwiftUI%20via%20@appcodamobile&amp;url=https://www.appcoda.com.tw/swiftui/&amp;hashtags=swiftlang" target="blank" class="custom-link">Tweet this book</a>
            </li>
        
        

        
        <li class="divider"></li>
        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                        序言
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="swiftui-basics.html">
            
                
                    <a href="./swiftui-basics.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        SwiftUI 介绍
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="swiftui-text.html">
            
                
                    <a href="./swiftui-text.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        SwiftUI 入门 - 文字的处理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="swiftui-images.html">
            
                
                    <a href="./swiftui-images.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        图片的处理
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="swiftui-stacks.html">
            
                
                    <a href="./swiftui-stacks.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        以堆叠布局使用者介面
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="swiftui-scrollview.html">
            
                
                    <a href="./swiftui-scrollview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        ScrollView 与 Carousel UI 的建立
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="swiftui-buttons.html">
            
                
                    <a href="./swiftui-buttons.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        SwiftUI 按钮与渐层
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="swiftui-state.html">
            
                
                    <a href="./swiftui-state.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        状态(State)与绑定(Binding)
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="swiftui-path-shape.html">
            
                
                    <a href="./swiftui-path-shape.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        实现路径(Path)与形状(Shape)来画线与圆饼图
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="swiftui-animation.html">
            
                
                    <a href="./swiftui-animation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        基础动画与转场
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="swiftui-list.html">
            
                
                    <a href="./swiftui-list.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        动态列表、 ForEach 与 Identifiable 的使用方法
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="swiftui-navigation.html">
            
                
                    <a href="./swiftui-navigation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        导览UI与导览列客制化运用
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="swiftui-modal.html">
            
                
                    <a href="./swiftui-modal.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        强制回应视图、浮动按钮与提示的实现
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="swiftui-form.html">
            
                
                    <a href="./swiftui-form.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        以选取器(Picker)、开关(Toggle)与步进器(Stepper)来建立一个表单
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="swiftui-form-data.html">
            
                
                    <a href="./swiftui-form-data.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        使用 Combine 与 Environment 物件进行资料分享
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="swiftui-form-registration.html">
            
                
                    <a href="./swiftui-form-registration.html">
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        以 Combine 与 视图模型建立一个注册表单
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="swiftui-actionsheet-context.html">
            
                
                    <a href="./swiftui-actionsheet-context.html">
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        滑动删除、内容选单与动作列表
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="swiftui-gestures.html">
            
                
                    <a href="./swiftui-gestures.html">
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        认识手势（Gestures）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="swiftui-bottom-sheet.html">
            
                
                    <a href="./swiftui-bottom-sheet.html">
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        以SwiftUI 手势与 GeometryReader 建立一个底部展开式页面
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="swiftui-trip-tinder.html">
            
                
                    <a href="./swiftui-trip-tinder.html">
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        使用手势与动画建立 Tinder 风格的 UI
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="swiftui-advanced-animations.html">
            
                
                    <a href="./swiftui-advanced-animations.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        建立像 Apple Wallet App 的动画和转场效果
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="swiftui-json.html">
            
                
                    <a href="./swiftui-json.html">
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        JSON、滑杆的运用与资料过滤
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="swiftui-core-data.html">
            
                
                    <a href="./swiftui-core-data.html">
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        如何使用 Core Data 建立 ToDo App
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="23" data-path="swiftui-uikit.html">
            
                
                    <a href="./swiftui-uikit.html">
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                        利用 UIViewRepresentable 整合UIKit 组件
                    </a>
                
            
            
        </li>
    
        <li class="chapter active" data-level="24" data-path="swiftui-searchbar.html">
            
                
                    <a href="./swiftui-searchbar.html">
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                        建立搜寻栏视图并使用自订绑定（Custom Binding）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="25" data-path="swiftui-real-world-app.html">
            
                
                    <a href="./swiftui-real-world-app.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                        把所学应用出来！构建个人理财App
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="26" data-path="swiftui-appstoreanimation.html">
            
                
                    <a href="./swiftui-appstoreanimation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                        创建类似App Store使用的动画视图转换
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="27" data-path="swiftui-carousel.html">
            
                
                    <a href="./swiftui-carousel.html">
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                        如何建立图像轮播（Image Carousel）
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="28" data-path="swiftui-expandable-list.html">
            
                
                    <a href="./swiftui-expandable-list.html">
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                        如何建立展开式列表视图和大纲视图
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="29" data-path="swiftui-gridlayout.html">
            
                
                    <a href="./swiftui-gridlayout.html">
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                        使用 LazyVGrid 和 LazyHGrid 构建集合视图
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="30" data-path="swiftui-progress-ring.html">
            
                
                    <a href="./swiftui-progress-ring.html">
                        <i class="fa fa-check"></i>
                        
                            <b>30.</b>
                        
                        使用 Shape 和 Animatable 开发带动画的环形进度条
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="31" data-path="swiftui-library.html">
            
                
                    <a href="./swiftui-library.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.</b>
                        
                        如何使用 AnimatableModifier 和 LibraryContentProvider
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="32" data-path="swiftui-texteditor.html">
            
                
                    <a href="./swiftui-texteditor.html">
                        <i class="fa fa-check"></i>
                        
                            <b>32.</b>
                        
                        使用 TextEditor 支持多行文字输入
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="33" data-path="swiftui-matchedgeometry.html">
            
                
                    <a href="./swiftui-matchedgeometry.html">
                        <i class="fa fa-check"></i>
                        
                            <b>33.</b>
                        
                        使用 matchedGeometryEffect为 App 建立绚丽的视图动画
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="34" data-path="swiftui-grid-animation.html">
            
                
                    <a href="./swiftui-grid-animation.html">
                        <i class="fa fa-check"></i>
                        
                            <b>34.</b>
                        
                        ScrollViewReader 和网格动画
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="35" data-path="swiftui-tabview.html">
            
                
                    <a href="./swiftui-tabview.html">
                        <i class="fa fa-check"></i>
                        
                            <b>35.</b>
                        
                        标签视图的运用与自订标签列
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="36" data-path="swiftui-asyncimage.html">
            
                
                    <a href="./swiftui-asyncimage.html">
                        <i class="fa fa-check"></i>
                        
                            <b>36.</b>
                        
                        利用 AsyncImage 非同步加载和显示图像
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="37" data-path="swiftui-searchable.html">
            
                
                    <a href="./swiftui-searchable.html">
                        <i class="fa fa-check"></i>
                        
                            <b>37.</b>
                        
                        利用 Searchable 建立搜寻栏
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="38" data-path="swiftui-charts.html">
            
                
                    <a href="./swiftui-charts.html">
                        <i class="fa fa-check"></i>
                        
                            <b>38.</b>
                        
                        利用 Charts 框架建立图表
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="39" data-path="swiftui-live-text.html">
            
                
                    <a href="./swiftui-live-text.html">
                        <i class="fa fa-check"></i>
                        
                            <b>39.</b>
                        
                        利用 Live Text API 从图片中撷取文本
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="40" data-path="swiftui-sharelink.html">
            
                
                    <a href="./swiftui-sharelink.html">
                        <i class="fa fa-check"></i>
                        
                            <b>40.</b>
                        
                        通过 ShareLink 来分享文本和图像等资料
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="41" data-path="swiftui-imagerenderer.html">
            
                
                    <a href="./swiftui-imagerenderer.html">
                        <i class="fa fa-check"></i>
                        
                            <b>41.</b>
                        
                        利用 ImageRenderer API 轻松把 SwiftUI 视图转换为图像
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="42" data-path="swiftui-pdf-doc.html">
            
                
                    <a href="./swiftui-pdf-doc.html">
                        <i class="fa fa-check"></i>
                        
                            <b>42.</b>
                        
                        如何把 SwiftUI 视图转换为 PDF 文件
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="43" data-path="swiftui-gauge.html">
            
                
                    <a href="./swiftui-gauge.html">
                        <i class="fa fa-check"></i>
                        
                            <b>43.</b>
                        
                        使用 Gauge 视图显示进度并创建速度计
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="44" data-path="swiftui-grid.html">
            
                
                    <a href="./swiftui-grid.html">
                        <i class="fa fa-check"></i>
                        
                            <b>44.</b>
                        
                        使用Grid API 创建网格布局
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="45" data-path="swiftui-anylayout.html">
            
                
                    <a href="./swiftui-anylayout.html">
                        <i class="fa fa-check"></i>
                        
                            <b>45.</b>
                        
                        利用 AnyLayout 切换 UI 布局
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="46" data-path="swiftui-navigationstack.html">
            
                
                    <a href="./swiftui-navigationstack.html">
                        <i class="fa fa-check"></i>
                        
                            <b>46.</b>
                        
                        使用新的 NavigationStack 视图构建资料导向的导航
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                本书使用 GitBook 释出
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="目录"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="搜寻"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="字型设定"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">衬线体</button>
        <button type="button" data-font="1" class="button">无衬线体</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">白色</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">棕褐色</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">夜间</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="分享"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    分享到 Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    分享到 Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    分享到 Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    分享到 Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    分享到 Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >精通 SwiftUI - iOS 16 版</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="%E7%AC%AC-24-%E7%AB%A0-br-%E5%BB%BA%E7%AB%8B%E6%90%9C%E5%B0%8B%E6%AC%84%E8%A6%96%E5%9C%96%E4%B8%A6%E4%BD%BF%E7%94%A8%E8%87%AA%E8%A8%82%E7%B6%81%E5%AE%9A%EF%BC%88custom-binding%EF%BC%89">第 24 章<br>建立搜寻栏视图并使用自订绑定（Custom Binding）</h1>
<p>之前，我们向你讲解了如何利用 UIKit 框架的<code>UISearchBar</code> 来实现搜索栏。 你有没有想过从头开始自己建立一个？ 如果仔细看看搜寻栏，要自己做出来并不太难。 所以，让我们在本章中尝试构建一个 SwiftUI 版本的搜寻栏。</p>
<p>你不仅可以学习如何建立搜寻栏视图，我们还将会和你讲解如何使用自订绑定。 之前我们讨论过绑定，但还没有向你展示如何建立自定义绑定。 当你需要为绑定（Binding）加入额外的程式逻辑时，自订绑定就特别有用。 另外，你也会学习如何在 SwiftUI 中关闭软体键盘。</p>
<p>图 24.1 就是我们将要建立的搜索栏，外观与 UIKit 中的 UISearchBar 非常相似。 同样地，这个搜索栏也会有个 <em>Cancel</em> 按钮，当使用者开始输入搜寻文字时就会出现。</p>
<figure id="fig24.1"><img src="images/searchbar/swiftui-searchbar-1.png" alt="图 24.1. 利用 SwiftUI 自己建立搜寻栏"><figcaption>图 24.1. 利用 SwiftUI 自己建立搜寻栏</figcaption></figure>
<h3 id="%E5%AF%A6%E4%BD%9C%E6%90%9C%E5%B0%8B%E6%AC%84-ui">实现搜寻栏 UI</h3>
<p>我们将会修改之前的项目转为我们自己建立的搜寻栏。 因此，请首先从 <a href="https://www.appcoda.com/resources/swiftui4/SwiftUIToDoListUISearchBar.zip" target="_blank">https://www.appcoda.com/resources/swiftui4/SwiftUIToDoListUISearchBar.zip</a> 下载启动项目。 编译一次以确保它有效。 该App应该向你显示一个搜索栏，但是，该栏来自 UIKit。 我们将把它转换成一个完全使用 SwiftUI 构建的搜寻栏视图。</p>
<p>打开<code>SearchBar.swift</code>，这是我们关注的文件。 我们将重写整段代码，但保持其名称不变。 我们仍然称它为“SearchBar”，它仍然接受搜寻文字的绑定作为参数。 对于调用者（即 ContentView），没有什么需要变更， 用法还是这样：</p>
<pre><code class="lang-swift"><span class="hljs-type">SearchBar</span>(text: $searchText)
</code></pre>
<p>现在，让我们从 UI 开始做起。 如果你想挑战自己，请停止阅读并尝试自己实现搜寻栏 UI。 这个使用者介界非常简单。 它由一个文字栏、几个图标和取消按钮组成。</p>
<p>如果你不知道 UI 是如何建立的，就让我们一起写出来吧。 请将 <code>SearchBar.swift</code> 中的 <code>SearchBar</code> 结构改成这样：</p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SearchBar</span>: <span class="hljs-title">View</span> </span>{
    @<span class="hljs-type">Binding</span> <span class="hljs-keyword">var</span> text: <span class="hljs-type">String</span>

    @<span class="hljs-type">State</span> private <span class="hljs-keyword">var</span> isEditing = <span class="hljs-built_in">false</span>

    <span class="hljs-keyword">var</span> body: some <span class="hljs-type">View</span> {
        <span class="hljs-type">HStack</span> {

            <span class="hljs-type">TextField</span>(<span class="hljs-string">&quot;Search ...&quot;</span>, text: $text)
                .padding(<span class="hljs-number">7</span>)
                .padding(.horizontal, <span class="hljs-number">25</span>)
                .background(<span class="hljs-type">Color</span>(.systemGray6))
                .cornerRadius(<span class="hljs-number">8</span>)
                .overlay(
                    <span class="hljs-type">HStack</span> {
                        <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;magnifyingglass&quot;</span>)
                            .foregroundColor(.gray)
                            .frame(minWidth: <span class="hljs-number">0</span>, maxWidth: .infinity, alignment: .leading)
                            .padding(.leading, <span class="hljs-number">8</span>)

                        <span class="hljs-keyword">if</span> isEditing {
                            <span class="hljs-type">Button</span>(action: {
                                <span class="hljs-keyword">self</span>.text = <span class="hljs-string">&quot;&quot;</span>
                            }) {
                                <span class="hljs-type">Image</span>(systemName: <span class="hljs-string">&quot;multiply.circle.fill&quot;</span>)
                                    .foregroundColor(.gray)
                                    .padding(.trailing, <span class="hljs-number">8</span>)
                            }
                        }
                    }
                )
                .padding(.horizontal, <span class="hljs-number">10</span>)
                .onTapGesture {
                    withAnimation {
                        <span class="hljs-keyword">self</span>.isEditing = <span class="hljs-built_in">true</span>
                    }
                }


            <span class="hljs-keyword">if</span> isEditing {
                <span class="hljs-type">Button</span>(action: {
                    <span class="hljs-keyword">self</span>.isEditing = <span class="hljs-built_in">false</span>
                    <span class="hljs-keyword">self</span>.text = <span class="hljs-string">&quot;&quot;</span>

                }) {
                    <span class="hljs-type">Text</span>(<span class="hljs-string">&quot;Cancel&quot;</span>)
                }
                .padding(.trailing, <span class="hljs-number">10</span>)
                .transition(.move(edge: .trailing)) 
            }
        }
    }
}
</code></pre>
<p>首先，我们声明了两个变量：一个是搜寻文字的绑定，另一个则用于存放搜寻状态（正在编辑与否）的变量。</p>
<p>我们使用 <code>HStack</code> 来布局文字栏和 <em>Cancel</em> 按钮。 对于文字栏，我们覆盖了一个放大镜图案和交叉图案（即<code>multiply.circle.fill</code>），它仅在搜寻栏处于编辑模式时显示。 <em>Cancel</em> 按钮也是如此，当使用者点击搜寻栏时才会出现。</p>
<p>为了预览搜寻栏，还请加入以下代码：</p>
<pre><code class="lang-swift"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">SearchBar_Previews</span>: <span class="hljs-title">PreviewProvider</span> </span>{
    <span class="hljs-keyword">static</span> <span class="hljs-keyword">var</span> previews: some <span class="hljs-type">View</span> {
        <span class="hljs-type">SearchBar</span>(text: .constant(<span class="hljs-string">&quot;&quot;</span>))
    }
}
</code></pre>
<p>当加入代码后，你应该能够预览搜寻栏。 现在按<em>播放</em> 钮进行测试。 当你选择搜寻栏时，<em>取消</em> 按钮就会出现。</p>
<figure id="fig24.2"><img src="images/searchbar/swiftui-searchbar-2.png" alt="图 24.2. 预览搜寻栏"><figcaption>图 24.2. 预览搜寻栏</figcaption></figure>
<p>更重要的是，搜寻栏已经可以使用了！ 在模拟器上运行App并输入搜寻字，它就会根据显示相关的搜索结果。</p>
<figure id="fig24.3"><img src="images/searchbar/swiftui-searchbar-3.png" alt="图 24.3. 搜寻栏已正式运作"><figcaption>图 24.3. 搜寻栏已正式运作</figcaption></figure>
<h3 id="%E9%97%9C%E9%96%89%E9%8D%B5%E7%9B%A4">关闭键盘</h3>
<p>如你所见，使用 SwiftUI 建立我们自己的搜寻栏并不太难。 在搜寻栏运作时，我们必须解决一个小问题。 你有否尝试点击取消按钮？ 它确实清除了搜寻文字。 然而，软键盘并没有消失。</p>
<p>为了解决这个问题，我们需要在 <em>Cancel</em> 按钮的 <code>action</code> 中添加一行程码：</p>
<pre><code class="lang-swift"><span class="hljs-comment">// 关闭键盘</span>
<span class="hljs-type">UIApplication</span>.shared.sendAction(#selector(<span class="hljs-type">UIResponder</span>.resignFirstResponder), to: <span class="hljs-built_in">nil</span>, from: <span class="hljs-built_in">nil</span>, <span class="hljs-keyword">for</span>: <span class="hljs-built_in">nil</span>)
</code></pre>
<p>在代码中，我们调用了 <code>sendAction</code> 方法来关闭键盘。 你现在可以使用模拟器运行App。 当你点击取消按钮时，它就会清除搜寻文字并关闭软体键盘。</p>
<h3 id="%E4%BD%BF%E7%94%A8%E8%87%AA%E8%A8%82%E7%B6%81%E5%AE%9A%EF%BC%88custom-binding%EF%BC%89">使用自订绑定（Custom Binding）</h3>
<p>SwiftUI 版本的搜寻栏已经可以正常使用了，不过我想藉此机会与你讨论自订绑定。 在 <code>SearchBar.swift</code> ，我们像这样声明搜寻文字的绑定：</p>
<pre><code class="lang-swift">@<span class="hljs-type">Binding</span> <span class="hljs-keyword">var</span> text: <span class="hljs-type">String</span>
</code></pre>
<p>它非常适合我们当前程式的运作。 但是让我来问问你， 如果我们在读取或写入此绑定时需要添加额外的逻辑，那可以怎么办？ 例如，如何将使用者输入的文字自动变成大写？</p>
<p>Swift 有一个内置的功能可以将字串变为大写。 你可以使用字串的 <code>capitalized</code> 属性取得大写文字串。但 问题是我们如何更新<code>text</code>的绑定？</p>
<p>在这种情况下，你需要在<code>SearchBar.swift</code>中建立一个自定义绑定，如下所示：</p>
<pre><code class="lang-swift">private <span class="hljs-keyword">var</span> searchText: <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">String</span>&gt; {

    <span class="hljs-keyword">return</span> <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">String</span>&gt;(
        <span class="hljs-keyword">get</span>: {
            <span class="hljs-keyword">self</span>.text.capitalized

        }, <span class="hljs-keyword">set</span>: {
            <span class="hljs-keyword">self</span>.text = $<span class="hljs-number">0</span>
        }
    )
}
</code></pre>
<p>在上面的代码中，我们建立了一个名为<code>searchText</code>的自定义绑定，其中包含读取和写入绑定值的闭包。 对于<code>get</code> 部分，我们通过<code>capitalized</code> 属性来自定义<code>text</code> 的绑定值。 这就是我们如何将使用者的搜寻字转成大写。 至于<code>set</code> 部分，我们不做任何更改，只将其设置为原始值。 但是，如果在设置绑定时需要添加额外的逻辑，就需要修改<code>set</code>中的程码。</p>
<p>题外话，你可以省略 <code>return</code> 关键字，像这样写就可以：</p>
<pre><code class="lang-swift">private <span class="hljs-keyword">var</span> searchText: <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">String</span>&gt; {

    <span class="hljs-type">Binding</span>&lt;<span class="hljs-type">String</span>&gt;(
        <span class="hljs-keyword">get</span>: {
            <span class="hljs-keyword">self</span>.text.capitalized

        }, <span class="hljs-keyword">set</span>: {
            <span class="hljs-keyword">self</span>.text = $<span class="hljs-number">0</span>
        }
    )
}
</code></pre>
<p>以防你没有留意，这是自 Swift 5.1 就有的一项新功能，</p>
<p>我们仍在将 <code>text</code> 绑定传递给 <code>TextField</code>。 在此更改生效之前，我们需要再进行一个小修改。 更改<code>TextField</code>中的参数并确保将<code>searchText</code>作为绑定传递：</p>
<pre><code class="lang-swift"><span class="hljs-type">TextField</span>(<span class="hljs-string">&quot;Search ...&quot;</span>, text: searchText)
</code></pre>
<p>现在在模拟器上运行该App。 在搜寻栏输入几个词，App就会自动把每个单词的第一个字母变成大写。</p>
<figure id="fig24.4"><img src="images/searchbar/swiftui-searchbar-4.png" alt="图 24.4. 自动把每个单词的第一个字母变成大写"><figcaption>图 24.4. 自动把每个单词的第一个字母变成大写</figcaption></figure>
<h3 id="%E7%B8%BD%E7%B5%90">总结</h3>
<p>在本章中，我们向你展示了另一种实现搜寻栏的方法。 如你所见，单是用 SwiftUI 建立一个搜寻栏并不困难。 你还学习了如何建立自定义绑定。 当你在设置或检索绑定值时需要添加额外的程序时，这就非常有用。</p>
<p>在本章所准备的示例档中，有最后完整的 Xcode 项目，可供你参考：</p>
<p><a href="https://www.appcoda.com/resources/swiftui4/SwiftUIToDoListSearchBarView.zip" target="_blank">https://www.appcoda.com/resources/swiftui4/SwiftUIToDoListSearchBarView.zip</a></p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./swiftui-uikit.html" class="navigation navigation-prev " aria-label="Previous page: 利用 UIViewRepresentable 整合UIKit 组件"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./swiftui-real-world-app.html" class="navigation navigation-next " aria-label="Next page: 把所学应用出来！构建个人理财App"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":"white","family":"serif","size":3},"image-captions":{"caption":"_CAPTION_","variable_name":"_pictures"}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
